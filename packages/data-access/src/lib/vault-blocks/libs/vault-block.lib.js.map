{"version":3,"sources":["../../../../../../../../libs/shared/data-access/src/lib/vault-blocks/libs/vault-block.lib.ts"],"sourcesContent":["import BigNumber from 'bignumber.js'\nimport {\n  apr2apy,\n  BNFixed,\n  BNify,\n  BNlt,\n  BNlte,\n  iBigInt,\n  SECONDS_IN_YEAR,\n} from '../../core'\nimport {\n  Vault,\n  VaultContractAPRs,\n  VaultContractData,\n  VaultContractType,\n  VaultIntegrationsData,\n  VaultRewardProgram,\n} from '../../vaults'\nimport {\n  RewardToken,\n  VaultBlock,\n  VaultBlockAPRs,\n  VaultBlockAPYs,\n  VaultContractCdoEpochInstantWithdrawsData,\n} from '../vault-block.model'\nimport { getVaultRewardProgramsApr } from './vault-block-rewards.lib'\nimport {\n  VaultEpochProgression,\n  VaultEpochStatus,\n  VaultEpochWithdrawType,\n} from '../../vault-epochs'\nimport moment from 'moment'\n\n/**\n * Parse APRs from contract data\n * @param APRs vault contract raw APRs\n * @returns parsed APRs\n */\nexport function parseVaultContractAPRs(\n  APRs: VaultContractAPRs,\n  integrationsData?: VaultIntegrationsData\n): VaultBlockAPRs {\n  // Get APR from integration\n  if (integrationsData?.APR) {\n    return {\n      BASE: integrationsData.APR,\n    }\n  }\n  return {\n    BASE: BNify(APRs.BASE).div(1e18).toNumber(),\n  }\n}\n\n/**\n * Convert vault APRs into APYs\n * @param vault vault entity\n * @param APRs vault APRs\n * @returns Compounded APRs\n */\nexport function parseAPYs(\n  vaultContractType: VaultContractType,\n  APRs: VaultBlockAPRs,\n  options?: {\n    feePercentage?: number\n    totalDuration?: number\n  }\n): VaultBlockAPYs {\n  const { feePercentage, totalDuration } = options || {}\n\n  // Compound Base APY\n  const BASE = compoundVaultApr(\n    vaultContractType,\n    'BASE',\n    APRs.BASE,\n    totalDuration\n  )\n\n  const grossNetAPR = Number(\n    BNify(APRs.BASE)\n      .plus(BNify(APRs.HARVEST))\n      .times(BNify(1).minus(BNify(feePercentage).div(1e5)))\n  )\n\n  // Compound Net APY\n  const NET = Number(\n    BNify(\n      compoundVaultApr(\n        vaultContractType,\n        'NET',\n        grossNetAPR || 0,\n        totalDuration\n      )\n    ).plus(BNify(APRs.REWARDS))\n  )\n\n  const HARVEST =\n    APRs.HARVEST &&\n    compoundVaultApr(vaultContractType, 'HARVEST', APRs.HARVEST, totalDuration)\n\n  const REWARDS =\n    APRs.REWARDS &&\n    compoundVaultApr(vaultContractType, 'REWARDS', APRs.REWARDS, totalDuration)\n\n  // Calculate GROSS APY\n  const GROSS = Number(\n    BNify(BASE).plus(BNify(HARVEST)).plus(BNify(REWARDS)).toFixed(8)\n  )\n\n  const FEE = Number(BNify(feePercentage).div(1e3))\n\n  const APYs: VaultBlockAPYs = {\n    BASE,\n    NET,\n    GROSS,\n    FEE,\n  }\n  if (HARVEST) {\n    APYs.HARVEST = HARVEST\n  }\n  if (REWARDS) {\n    APYs.REWARDS = REWARDS\n  }\n\n  return APYs\n}\n\n/**\n * Compound vault APR\n * @param vault vault entity\n * @param type APR type\n * @param rate APR\n * @returns Compounded APR\n */\nexport function compoundVaultApr(\n  vaultContractType: VaultContractType,\n  type: keyof VaultBlockAPRs,\n  rate: number,\n  totalDuration?: number\n): number {\n  switch (type) {\n    // Don't compound REWARD APR\n    case 'REWARDS':\n      return rate\n    default: {\n      const compoundingPeriod = getVaultCompoundingPeriod(\n        vaultContractType,\n        totalDuration\n      )\n\n      const APY = BNFixed(\n        apr2apy(BNify(rate).div(100), compoundingPeriod).times(100),\n        8\n      )\n\n      if (!BNify(Number(APY)).isFinite()) {\n        return 999999\n      }\n\n      return Number(APY)\n    }\n  }\n}\n\n/**\n * Get vault compounding period\n * @param vault vault entity\n * @param epochDuration epoch duration\n * @returns vault compounding period\n */\nexport function getVaultCompoundingPeriod(\n  vaultContractType: VaultContractType,\n  totalDuration?: number\n): number {\n  switch (vaultContractType) {\n    case 'CDO_EPOCH':\n      return BigNumber.minimum(\n        365,\n        BigNumber.maximum(1, BNify(365).div(BNify(totalDuration).div(86400)))\n      )\n        .integerValue(BigNumber.ROUND_FLOOR)\n        .toNumber()\n    default:\n      return 365\n  }\n}\n\n/**\n * Get vault APRs\n * @param vault vault entity\n * @param vaultData vault contract data\n * @param tvlUSD TVL converted in USD\n * @param rewardTokens reward tokens entities\n * @returns Vault APRs\n */\nexport function makeVaultAPRs(\n  vaultData: VaultContractData,\n  options: {\n    tvlUSD?: iBigInt\n    feePercentage?: number\n    rewardTokens?: RewardToken[]\n    rewardPrograms?: VaultRewardProgram[]\n    vaultContractType?: VaultContractType\n    integrations?: VaultIntegrationsData\n  } = {}\n): VaultBlockAPRs {\n  const { feePercentage, integrations } = options\n\n  const APRs = parseVaultContractAPRs(vaultData.APRs || {}, integrations)\n  const REWARDS = getVaultRewardProgramsApr(vaultData, APRs, options)\n\n  // Calculate GROSS APR\n  const GROSS = Number(\n    BNFixed(BNify(APRs.BASE).plus(BNify(APRs.HARVEST)).plus(BNify(REWARDS)), 8)\n  )\n\n  // Calculate NET APR\n  const NET = Number(\n    BNFixed(\n      BNify(APRs.BASE)\n        .plus(BNify(APRs.HARVEST))\n        .times(BNify(1).minus(BNify(feePercentage).div(1e5)))\n        .plus(BNify(REWARDS)),\n      8\n    )\n  )\n\n  const FEE = Number(BNify(feePercentage).div(1e3))\n\n  return {\n    ...APRs,\n    REWARDS,\n    GROSS,\n    NET,\n    FEE,\n  }\n}\n\n/**\n * Get vault expected deposit interests\n * @param block - the vault block\n * @param depositAmount - the deposit amount\n * @returns the interest amount expected of the epoch\n */\nexport function getVaultBlockDepositInterest(\n  block: VaultBlock,\n  depositAmount: string\n): string {\n  if (!block.cdoEpoch) {\n    return '0'\n  }\n\n  const { APRs } = block\n  const { duration, bufferDuration = 0 } = block.cdoEpoch\n\n  const interests = BNify(depositAmount)\n    .times(APRs.BASE || 0)\n    .div(100)\n    .times(duration + bufferDuration)\n    .div(SECONDS_IN_YEAR)\n    .toString()\n  const amount = BNFixed(interests, 0).toString()\n\n  return amount\n}\n\n/**\n * Get vault block withdrawable amount\n * @param block - the vault block\n * @param lpBalance - the LP balance\n * @param maxWithdrawable - the max withdrawable\n * @param withdrawAmount - the withdraw amount\n * @returns the underlying amount\n */\nexport function getVaultBlockWithdrawableAmount(\n  block: VaultBlock,\n  lpBalance: string,\n  maxWithdrawable: string,\n  withdrawAmount: string\n): string {\n  const balance = getVaultBlockUnderlyingAmount(block, lpBalance)\n\n  if (\n    BNlte(balance, 0) ||\n    BNlte(withdrawAmount, 0) ||\n    BNlte(maxWithdrawable, 0)\n  ) {\n    return '0'\n  }\n\n  const withdrawableAmount = BNify(withdrawAmount)\n    .times(maxWithdrawable)\n    .div(balance)\n    .toFixed(0)\n\n  return withdrawableAmount\n}\n\n/**\n * Get vault block Underlying amount\n * @param block - the vault block\n * @param token - the vault token\n * @param amount - the LP amount\n * @returns the LP price\n */\nexport function getVaultBlockUnderlyingAmount(\n  block: VaultBlock,\n  lpAmount: string\n): string {\n  return BNify(lpAmount).times(block.price).div(`1e18`).toFixed(0)\n}\n\n/**\n * Get epoch withdraw type by block\n * @param block the vault block\n * @returns epoch withdraw type\n */\nexport function getEpochWithdrawTypeByBlock(\n  block: VaultBlock\n): VaultEpochWithdrawType {\n  return block.cdoEpoch?.withdrawType || 'STANDARD'\n}\n\nexport function getVaultBlockEpochWithdrawType(\n  apr: number,\n  lastApr: number,\n  instantWithdraws?: Partial<VaultContractCdoEpochInstantWithdrawsData>\n): VaultEpochWithdrawType {\n  if (!instantWithdraws) {\n    return 'STANDARD'\n  }\n\n  const aprDiff = BNify(apr || 0).minus(lastApr || 0)\n  return BNlt(aprDiff, -(instantWithdraws.aprDelta || 0))\n    ? 'INSTANT'\n    : 'STANDARD'\n}\n\n/**\n * Get vault block next epoch interests\n * @param block - the vault block\n * @param lpBalance - the LP balance\n * @param maxWithdrawable - the max withdrawable\n * @returns the interest amounts\n */\nexport function getVaultBlockInterestAmounts(\n  block: VaultBlock,\n  lpBalance: string,\n  maxWithdrawable: string\n): { lp: string; amount: string } {\n  if (BNlte(maxWithdrawable, 0)) {\n    return { lp: '0', amount: '0' }\n  }\n\n  // For instant withdraw it's necessary calculate interest amounts\n  const withdrawType = getEpochWithdrawTypeByBlock(block)\n  if (withdrawType === 'INSTANT') {\n    return calculateVaultBlockInterestAmounts(block, lpBalance)\n  }\n\n  // Calculate new vault price\n  const newVaultPrice = BNify(maxWithdrawable).div(lpBalance).times(1e18)\n\n  if (BNlte(newVaultPrice, 0)) {\n    return { lp: '0', amount: '0' }\n  }\n\n  // Calculate LP amount and token amount\n  const lp = BNFixed(\n    BNify(newVaultPrice).minus(block.price).times(lpBalance).div(newVaultPrice)\n  )\n\n  const amount = BNFixed(BNify(lp).times(newVaultPrice).div(`1e18`))\n\n  return {\n    lp,\n    amount: BNlte(amount, 0) ? '0' : amount,\n  }\n}\n\n/**\n * Calculate vault block interest amounts\n * @param block - the vault block\n * @param lpBalance - the LP balance\n * @returns the interest amounts\n */\nexport function calculateVaultBlockInterestAmounts(\n  block: VaultBlock,\n  lpBalance: string\n): {\n  lp: string\n  amount: string\n} {\n  if (BNlte(block.cdoEpoch?.apr, 0)) {\n    return { lp: '0', amount: '0' }\n  }\n\n  // Calculate epoch APR\n  const aprPercentage = BNify(block.cdoEpoch?.apr).div(100)\n  const epochApr = aprPercentage.div(\n    BNify(SECONDS_IN_YEAR).div(block.cdoEpoch?.duration || 0)\n  )\n\n  // Calculate future interests\n  const futureLp = BNify(lpBalance)\n    .times(epochApr)\n    .div(BNify(epochApr).plus(1))\n    .toFixed(0)\n  const futureInterest = getVaultBlockUnderlyingAmount(block, futureLp)\n\n  return {\n    amount: futureInterest,\n    lp: futureLp,\n  }\n}\n\n/**\n * Get vault epoch status by block\n * @param vault - the cdo epoch vault\n * @param block - the vault block\n * @returns the epoch client status\n */\nexport function getVaultBlockEpochStatus(\n  block: VaultBlock,\n  date?: Date\n): VaultEpochStatus | undefined {\n  if (!block.cdoEpoch) {\n    return\n  }\n\n  const { status, endDate } = block.cdoEpoch\n\n  if (status === 'DEFAULTED' || status === 'WAITING') {\n    return status\n  }\n\n  // Check finished status\n  if (moment(date).isAfter(endDate)) {\n    return 'FINISHED'\n  }\n\n  // Running\n  return status\n}\n\n/**\n * Get vault block CAP progression\n * @param vault - the vault\n * @param block - the vault block\n * @returns the percentage of completion\n */\nexport function getVaultBlockCapProgression(\n  vault: Vault,\n  block: VaultBlock\n): number {\n  if (!vault.maxCap?.isActive) {\n    return 0\n  }\n\n  const maxCap = vault.maxCap.amount\n  const currentTvl = block.TVL?.USD || 0\n  return BNify(currentTvl).div(maxCap).times(100).toNumber()\n}\n\n/**\n * Get vault block epoch waiting progression data\n * @param block - the vault block\n * @param date - the date to use\n * @returns the progression data\n */\nexport function getVaultBlockEpochWaitingProgression(\n  block: VaultBlock,\n  date?: Date\n): VaultEpochProgression {\n  const waitingPeriod = block.cdoEpoch?.bufferDuration || 0\n\n  // Current end date and next start date\n  const endDate = moment(block.cdoEpoch?.endDate).toISOString()\n  const startDate = moment(endDate).add(waitingPeriod, 'second').toISOString()\n\n  const progression = BNify(moment(date).diff(endDate, 'second'))\n    .div(waitingPeriod)\n    .times(100)\n    .toNumber()\n  const progress = BigNumber.minimum(100, progression).toNumber()\n\n  return {\n    startDate,\n    endDate,\n    progress,\n  }\n}\n\n/**\n * Get vault block epoch progression data\n * @param block - the vault block\n * @param date - the date to use\n * @returns the progression data\n */\nexport function getVaultBlockEpochProgression(\n  block: VaultBlock,\n  date?: Date\n): VaultEpochProgression {\n  const duration = BNify(block.cdoEpoch?.duration)\n\n  // Current end date and next start date\n  const startDate = moment(block.cdoEpoch?.startDate).toISOString()\n  const endDate = moment(block.cdoEpoch?.endDate).toISOString()\n\n  const progression = BNify(moment(date).diff(startDate, 'second'))\n    .div(duration)\n    .times(100)\n\n  const progress = BigNumber.minimum(100, progression).toNumber()\n\n  return {\n    startDate,\n    endDate,\n    progress,\n  }\n}\n\n/**\n * Get Vault block net APY\n * @param block - the vault block\n * @returns the vault block net APY calculated by gross and net\n */\nexport function getVaultBlockAPYNet(\n  block: VaultBlock,\n  type: 'BASE' | 'REWARDS'\n): string {\n  if (BNlte(block.APYs.NET, 0) || BNlte(block.APYs.GROSS, 0)) {\n    return '0'\n  }\n\n  const apyGross = type === 'BASE' ? block.APYs.BASE : block.APYs.REWARDS\n  if (BNlte(apyGross, 0)) {\n    return '0'\n  }\n\n  return BNify(apyGross)\n    .times(block.APYs.NET || 0)\n    .div(block.APYs.GROSS || 0)\n    .toString()\n}\n"],"names":["BigNumber","apr2apy","BNFixed","BNify","BNlt","BNlte","SECONDS_IN_YEAR","getVaultRewardProgramsApr","moment","parseVaultContractAPRs","APRs","integrationsData","APR","BASE","div","toNumber","parseAPYs","vaultContractType","options","feePercentage","totalDuration","compoundVaultApr","grossNetAPR","Number","plus","HARVEST","times","minus","NET","REWARDS","GROSS","toFixed","FEE","APYs","type","rate","compoundingPeriod","getVaultCompoundingPeriod","APY","isFinite","minimum","maximum","integerValue","ROUND_FLOOR","makeVaultAPRs","vaultData","integrations","getVaultBlockDepositInterest","block","depositAmount","cdoEpoch","duration","bufferDuration","interests","toString","amount","getVaultBlockWithdrawableAmount","lpBalance","maxWithdrawable","withdrawAmount","balance","getVaultBlockUnderlyingAmount","withdrawableAmount","lpAmount","price","getEpochWithdrawTypeByBlock","withdrawType","getVaultBlockEpochWithdrawType","apr","lastApr","instantWithdraws","aprDiff","aprDelta","getVaultBlockInterestAmounts","lp","calculateVaultBlockInterestAmounts","newVaultPrice","aprPercentage","epochApr","futureLp","futureInterest","getVaultBlockEpochStatus","date","status","endDate","isAfter","getVaultBlockCapProgression","vault","maxCap","isActive","currentTvl","TVL","USD","getVaultBlockEpochWaitingProgression","waitingPeriod","toISOString","startDate","add","progression","diff","progress","getVaultBlockEpochProgression","getVaultBlockAPYNet","apyGross"],"mappings":"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"}