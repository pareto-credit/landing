{"version":3,"sources":["../../../../../../../../libs/shared/data-access/src/lib/vault-blocks/libs/vault-block.lib.ts"],"sourcesContent":["import BigNumber from 'bignumber.js'\nimport {\n  apr2apy,\n  BNeq,\n  BNFixed,\n  BNgt,\n  BNify,\n  BNlt,\n  BNlte,\n  iBigInt,\n  MAX_APY,\n  SECONDS_IN_YEAR,\n} from '../../core'\nimport {\n  Vault,\n  VaultContractAPRs,\n  VaultContractData,\n  VaultContractType,\n  VaultIntegrationsData,\n  VaultRewardProgram,\n} from '../../vaults'\nimport {\n  RewardToken,\n  VaultBlock,\n  VaultBlockAPRs,\n  VaultBlockAPYs,\n  VaultBlockCdoEpochInstantWithdraws,\n  VaultBlockEpochPrices,\n} from '../vault-block.model'\nimport { getVaultRewardProgramsApr } from './vault-block-rewards.lib'\nimport {\n  VaultEpochPrincipal,\n  VaultEpochProgression,\n  VaultEpochStatus,\n  VaultEpochWithdrawals,\n  VaultEpochWithdrawType,\n} from '../../vault-epochs'\nimport moment from 'moment'\n\n/**\n * Parse APRs from contract data\n * @param APRs vault contract raw APRs\n * @returns parsed APRs\n */\nexport function parseVaultContractAPRs(\n  APRs: VaultContractAPRs,\n  integrationsData?: VaultIntegrationsData\n): VaultBlockAPRs {\n  // Get APR from integration\n  if (integrationsData?.APR) {\n    return {\n      BASE: integrationsData.APR,\n    }\n  }\n  return {\n    BASE: BNify(APRs.BASE).div(1e18).toNumber(),\n  }\n}\n\n/**\n * Convert vault APRs into APYs\n * @param vault vault entity\n * @param APRs vault APRs\n * @returns Compounded APRs\n */\nexport function parseAPYs(\n  vaultContractType: VaultContractType,\n  APRs: VaultBlockAPRs,\n  options?: {\n    feePercentage?: number\n    totalDuration?: number\n    compoudingPeriod?: number\n  }\n): VaultBlockAPYs {\n  const { feePercentage, totalDuration, compoudingPeriod } = options || {}\n\n  // Compound Base APY\n  const BASE = compoundVaultApr(\n    vaultContractType,\n    'BASE',\n    APRs.BASE,\n    totalDuration,\n    compoudingPeriod\n  )\n\n  const grossNetAPR = Number(\n    BNify(APRs.BASE)\n      .plus(BNify(APRs.HARVEST))\n      .times(BNify(1).minus(BNify(feePercentage).div(1e5)))\n  )\n\n  // Compound Net APY\n  const NET = Number(\n    BNify(\n      compoundVaultApr(\n        vaultContractType,\n        'NET',\n        grossNetAPR || 0,\n        totalDuration,\n        compoudingPeriod\n      )\n    ).plus(BNify(APRs.REWARDS))\n  )\n\n  const HARVEST =\n    APRs.HARVEST &&\n    compoundVaultApr(\n      vaultContractType,\n      'HARVEST',\n      APRs.HARVEST,\n      totalDuration,\n      compoudingPeriod\n    )\n\n  const REWARDS =\n    APRs.REWARDS &&\n    compoundVaultApr(\n      vaultContractType,\n      'REWARDS',\n      APRs.REWARDS,\n      totalDuration,\n      compoudingPeriod\n    )\n\n  // Calculate GROSS APY\n  const GROSS = Number(\n    BNify(BASE).plus(BNify(HARVEST)).plus(BNify(REWARDS)).toFixed(8)\n  )\n\n  const FEE = Number(BNify(feePercentage).div(1e3))\n\n  const APYs: VaultBlockAPYs = {\n    BASE,\n    NET,\n    GROSS,\n    FEE,\n  }\n  if (HARVEST) {\n    APYs.HARVEST = HARVEST\n  }\n  if (REWARDS) {\n    APYs.REWARDS = REWARDS\n  }\n\n  return APYs\n}\n\n/**\n * Compound vault APR\n * @param vault vault entity\n * @param type APR type\n * @param rate APR\n * @returns Compounded APR\n */\nexport function compoundVaultApr(\n  vaultContractType: VaultContractType,\n  type: keyof VaultBlockAPRs,\n  rate: number,\n  totalDuration?: number,\n  compoudingPeriod?: number\n): number {\n  switch (type) {\n    // Don't compound REWARD APR\n    case 'REWARDS':\n      return rate\n    default: {\n      const compoundPeriod =\n        compoudingPeriod ||\n        getVaultCompoundingPeriod(vaultContractType, totalDuration)\n\n      const APY = BNFixed(\n        apr2apy(BNify(rate).div(100), compoundPeriod).times(100),\n        8\n      )\n\n      if (!BNify(Number(APY)).isFinite() || BNgt(APY, MAX_APY)) {\n        return MAX_APY\n      }\n\n      return Number(APY)\n    }\n  }\n}\n\n/**\n * Get vault compounding period\n * @param vault vault entity\n * @param epochDuration epoch duration\n * @returns vault compounding period\n */\nexport function getVaultCompoundingPeriod(\n  vaultContractType: VaultContractType,\n  totalDuration?: number\n): number {\n  switch (vaultContractType) {\n    case 'CDO_EPOCH':\n      return BigNumber.minimum(\n        365,\n        BigNumber.maximum(1, BNify(365).div(BNify(totalDuration).div(86400)))\n      )\n        .integerValue(BigNumber.ROUND_FLOOR)\n        .toNumber()\n    default:\n      return 365\n  }\n}\n\n/**\n * Get vault APRs\n * @param vault vault entity\n * @param vaultData vault contract data\n * @param tvlUSD TVL converted in USD\n * @param rewardTokens reward tokens entities\n * @returns Vault APRs\n */\nexport function makeVaultAPRs(\n  vaultData: VaultContractData,\n  options: {\n    tvlUSD?: iBigInt\n    feePercentage?: number\n    rewardTokens?: RewardToken[]\n    rewardPrograms?: VaultRewardProgram[]\n    vaultContractType?: VaultContractType\n    integrations?: VaultIntegrationsData\n  } = {}\n): VaultBlockAPRs {\n  const { feePercentage, integrations } = options\n  const APRs = parseVaultContractAPRs(vaultData.APRs || {}, integrations)\n  const REWARDS = getVaultRewardProgramsApr(vaultData, APRs, options)\n\n  // Calculate GROSS APR\n  const GROSS = Number(\n    BNFixed(BNify(APRs.BASE).plus(BNify(APRs.HARVEST)).plus(BNify(REWARDS)), 8)\n  )\n\n  // Calculate NET APR\n  const NET = Number(\n    BNFixed(\n      BNify(APRs.BASE)\n        .plus(BNify(APRs.HARVEST))\n        .times(BNify(1).minus(BNify(feePercentage).div(1e5)))\n        .plus(BNify(REWARDS)),\n      8\n    )\n  )\n\n  const FEE = Number(BNify(feePercentage).div(1e3))\n\n  return {\n    ...APRs,\n    REWARDS,\n    GROSS,\n    NET,\n    FEE,\n  }\n}\n\n/**\n * Get vault expected deposit interests\n * @param block - the vault block\n * @param depositAmount - the deposit amount\n * @returns the interest amount expected of the epoch\n */\nexport function getVaultBlockDepositInterest(\n  block: VaultBlock,\n  depositAmount: string\n): string {\n  if (!block.cdoEpoch) {\n    return '0'\n  }\n\n  const { APRs } = block\n  const { duration, bufferDuration = 0 } = block.cdoEpoch\n\n  const interests = BNify(depositAmount)\n    .times(APRs.BASE || 0)\n    .div(100)\n    .times(duration + bufferDuration)\n    .div(SECONDS_IN_YEAR)\n    .toString()\n  const amount = BNFixed(interests, 0).toString()\n\n  return amount\n}\n\n/**\n * Get vault block withdrawable amount\n * @param block - the vault block\n * @param lpBalance - the LP balance\n * @param maxWithdrawable - the max withdrawable\n * @param withdrawAmount - the withdraw amount\n * @returns the underlying amount\n */\nexport function getVaultBlockWithdrawableAmount(\n  block: VaultBlock,\n  lpBalance: string,\n  maxWithdrawable: string,\n  withdrawAmount: string\n): string {\n  const balance = getVaultBlockUnderlyingAmount(block, lpBalance)\n\n  if (\n    BNlte(balance, 0) ||\n    BNlte(withdrawAmount, 0) ||\n    BNlte(maxWithdrawable, 0)\n  ) {\n    return '0'\n  }\n\n  const withdrawableAmount = BNify(withdrawAmount)\n    .times(maxWithdrawable)\n    .div(balance)\n    .toFixed(0)\n\n  return withdrawableAmount\n}\n\n/**\n * Get vault block Underlying amount\n * @param block - the vault block\n * @param lpAmount - the LP token amount\n * @param price - the price of LP token\n * @returns the LP price\n */\nexport function getVaultBlockUnderlyingAmount(\n  block: VaultBlock,\n  lpAmount: string,\n  price?: string\n): string {\n  return BNify(lpAmount)\n    .times(price || block.price)\n    .div(`1e18`)\n    .toFixed(0)\n}\n\n/**\n * Get epoch withdraw type by block\n * @param block the vault block\n * @returns epoch withdraw type\n */\nexport function getEpochWithdrawTypeByBlock(\n  block: VaultBlock\n): VaultEpochWithdrawType {\n  return block.cdoEpoch?.withdrawType || 'STANDARD'\n}\n\nexport function getVaultBlockEpochWithdrawType(\n  apr: number,\n  lastApr: number,\n  instantWithdraws?: Partial<VaultBlockCdoEpochInstantWithdraws>\n): VaultEpochWithdrawType {\n  if (!instantWithdraws) {\n    return 'STANDARD'\n  }\n\n  const aprDiff = BNify(apr || 0).minus(lastApr || 0)\n  return BNlt(aprDiff, -(instantWithdraws.aprDelta || 0))\n    ? 'INSTANT'\n    : 'STANDARD'\n}\n\n/**\n * Get vault block next epoch interests\n * @param block - the vault block\n * @param lpBalance - the LP balance\n * @param maxWithdrawable - the max withdrawable\n * @returns the interest amounts\n */\nexport function getVaultBlockInterestAmounts(\n  block: VaultBlock,\n  lpBalance: string,\n  maxWithdrawable: string\n): { lp: string; amount: string } {\n  if (BNlte(maxWithdrawable, 0)) {\n    return { lp: '0', amount: '0' }\n  }\n\n  // For instant withdraw it's necessary calculate interest amounts\n  const withdrawType = getEpochWithdrawTypeByBlock(block)\n  if (withdrawType === 'INSTANT') {\n    return calculateVaultBlockInterestAmounts(block, lpBalance)\n  }\n\n  // Calculate new vault price\n  const newVaultPrice = BNify(maxWithdrawable).div(lpBalance).times(1e18)\n\n  if (BNlte(newVaultPrice, 0)) {\n    return { lp: '0', amount: '0' }\n  }\n\n  // Calculate LP amount and token amount\n  const lp = BNFixed(\n    BNify(newVaultPrice).minus(block.price).times(lpBalance).div(newVaultPrice)\n  )\n\n  const totalDuration = BNify(block.cdoEpoch?.duration || 0).plus(\n    block.cdoEpoch?.bufferDuration || 0\n  )\n\n  const amount = BNify(lp).times(newVaultPrice).div(`1e18`)\n\n  // Scale amount by epoch duration\n  const scaledAmount = BNgt(totalDuration)\n    ? amount.times(totalDuration).div(block.cdoEpoch?.duration || 1)\n    : amount\n\n  return {\n    lp,\n    amount: BNlte(scaledAmount, 0) ? '0' : BNFixed(scaledAmount),\n  }\n}\n\n/**\n * Calculate vault block interest amounts\n * @param block - the vault block\n * @param lpBalance - the LP balance\n * @returns the interest amounts\n */\nexport function calculateVaultBlockInterestAmounts(\n  block: VaultBlock,\n  lpBalance: string\n): {\n  lp: string\n  amount: string\n} {\n  if (BNlte(block.cdoEpoch?.apr, 0)) {\n    return { lp: '0', amount: '0' }\n  }\n\n  // Calculate epoch APR\n  const aprPercentage = BNify(block.cdoEpoch?.apr).div(100)\n  const epochApr = aprPercentage.div(\n    BNify(SECONDS_IN_YEAR).div(block.cdoEpoch?.duration || 0)\n  )\n\n  // Calculate future interests\n  const futureLp = BNify(lpBalance)\n    .times(epochApr)\n    .div(BNify(epochApr).plus(1))\n    .toFixed(0)\n  const futureInterest = getVaultBlockUnderlyingAmount(block, futureLp)\n\n  return {\n    amount: futureInterest,\n    lp: futureLp,\n  }\n}\n\n/**\n * Get vault epoch status by block\n * @param vault - the cdo epoch vault\n * @param block - the vault block\n * @returns the epoch client status\n */\nexport function getVaultBlockEpochStatus(\n  block: VaultBlock,\n  date?: Date\n): VaultEpochStatus | undefined {\n  if (!block.cdoEpoch) {\n    return\n  }\n\n  const { status, endDate } = block.cdoEpoch\n\n  if (status === 'DEFAULTED' || status === 'WAITING') {\n    return status\n  }\n\n  // Check finished status\n  if (moment(date).isAfter(endDate)) {\n    return 'FINISHED'\n  }\n\n  // Running\n  return status\n}\n\n/**\n * Get vault block cap status\n * @param vault - the vault\n * @param block - the vault block\n * @param contractLimit - the limit by contract\n * @returns the cap status object\n */\nexport function getVaultBlockCapStatus(\n  vault: Vault,\n  block: VaultBlock,\n  contractLimit?: string\n): { isActive: boolean; progression?: number; delta?: string; limit?: string } {\n  const limit =\n    vault.maxCap?.amount !== undefined\n      ? BNeq(contractLimit)\n        ? vault.maxCap?.amount\n        : BigNumber.minimum(contractLimit || 0, vault.maxCap?.amount).toString()\n      : contractLimit\n\n  if (limit === undefined || BNlte(limit)) {\n    return { isActive: false }\n  }\n\n  const tvl = BNify(block.TVL?.withRequestsUSD)\n  const delta = BNgt(limit, tvl) ? BNify(limit).minus(tvl).toString() : '0'\n  const tvlProgression = BNify(tvl).div(limit).times(100)\n  const progression = BigNumber.minimum(100, tvlProgression).toNumber()\n\n  return {\n    limit,\n    progression,\n    delta,\n    isActive: true,\n  }\n}\n\n/**\n * Get vault block CAP progression\n * @param vault - the vault\n * @param block - the vault block\n * @returns the percentage of completion\n */\nexport function getVaultBlockCapProgression(\n  vault: Vault,\n  block: VaultBlock\n): number {\n  if (!vault.maxCap?.isActive) {\n    return 0\n  }\n\n  const maxCap = vault.maxCap.amount\n  const currentTotalSupply = BNify(block.totalSupply).div(1e12)\n  return BNify(currentTotalSupply).div(maxCap).times(100).toNumber()\n}\n\n/**\n * Get vault block epoch waiting progression data\n * @param block - the vault block\n * @param date - the date to use\n * @returns the progression data\n */\nexport function getVaultBlockEpochWaitingProgression(\n  vault: Vault,\n  block: VaultBlock,\n  date?: Date\n): VaultEpochProgression {\n  const waitingPeriod =\n    vault.cdoEpoch?.waitingPeriod || block.cdoEpoch?.bufferDuration || 0\n\n  // Current end date and next start date\n  const startDate = moment(block.cdoEpoch?.endDate).toISOString()\n  const endDate = moment(startDate).add(waitingPeriod, 'second').toISOString()\n\n  const progression = BNify(moment(date).diff(startDate, 'second'))\n    .div(waitingPeriod)\n    .times(100)\n    .toNumber()\n  const progress = BigNumber.minimum(100, progression).toNumber()\n\n  return {\n    startDate,\n    endDate,\n    progress,\n  }\n}\n\n/**\n * Get vault block epoch progression data\n * @param block - the vault block\n * @param date - the date to use\n * @returns the progression data\n */\nexport function getVaultBlockEpochProgression(\n  block: VaultBlock,\n  date?: Date\n): VaultEpochProgression {\n  const duration = BNify(block.cdoEpoch?.duration)\n\n  // Current end date and next start date\n  const startDate = moment(block.cdoEpoch?.startDate).toISOString()\n  const endDate = moment(block.cdoEpoch?.endDate).toISOString()\n\n  const progression = BNify(moment(date).diff(startDate, 'second'))\n    .div(duration)\n    .times(100)\n\n  const progress = BigNumber.minimum(100, progression).toNumber()\n\n  return {\n    startDate,\n    endDate,\n    progress,\n  }\n}\n\n/**\n * Get Vault block net APY\n * @param block - the vault block\n * @returns the vault block net APY calculated by gross and net\n */\nexport function getVaultBlockAPYNet(\n  block: VaultBlock,\n  type: 'BASE' | 'REWARDS'\n): string {\n  if (BNlte(block.APYs.NET, 0) || BNlte(block.APYs.GROSS, 0)) {\n    return '0'\n  }\n\n  const apyGross = type === 'BASE' ? block.APYs.BASE : block.APYs.REWARDS\n  if (BNlte(apyGross, 0)) {\n    return '0'\n  }\n\n  return BNify(apyGross)\n    .times(block.APYs.NET || 0)\n    .div(block.APYs.GROSS || 0)\n    .toString()\n}\n\n/**\n * Filter vault blocks per day\n * @param blocks - the vault blocks\n * @returns the blocks filtered\n */\nexport function filterVaultBlocksPerDay(blocks: VaultBlock[]): VaultBlock[] {\n  const seenDates: string[] = []\n\n  return blocks.filter((block) => {\n    const date = moment.unix(block.block.timestamp).format('YYYY-MM-DD')\n    if (seenDates.includes(date)) {\n      return false\n    }\n    seenDates.push(date)\n    return true\n  })\n}\n\n/**\n * Return true if the epoch has been withdrawed\n * @param block - the vault block\n * @returns true if withdrawed\n */\nexport function isVaultBlockEpochWithdrawed(block: VaultBlock): boolean {\n  return block.cdoEpoch?.withdrawType !== 'INSTANT'\n    ? true\n    : BNlte(block.cdoEpoch.instantWithdraws?.amount)\n}\n\n/**\n * Get vault block epoch to withdraw\n * @param block - the vault block\n * @returns the amount to withdraw from the block\n */\nexport function getVaultBlockEpochToWithdraw(block: VaultBlock): string {\n  if (!block.cdoEpoch) {\n    return '0'\n  }\n\n  const instantWithdrawed = isVaultBlockEpochWithdrawed(block)\n\n  if (block.cdoEpoch.withdrawType === 'INSTANT' && !instantWithdrawed) {\n    return BNify(block.cdoEpoch.instantWithdraws?.amount).toString()\n  }\n\n  return BNify(block.cdoEpoch.expectedInterest)\n    .plus(BNify(block.cdoEpoch.withdraws?.amount))\n    .toString()\n}\n\n/**\n * Get vault block epoch withdrawals breakdown\n * @param block - the vault block\n * @returns the vault epoch withdrawals breakdown\n */\nexport function getVaultBlockEpochWithdrawalsBreakdown(\n  block: VaultBlock\n): VaultEpochWithdrawals {\n  if (!block.cdoEpoch) {\n    return { NET: '0', FEE: '0', INTEREST: '0', GROSS: '0' }\n  }\n\n  const { withdraws, instantWithdraws } = block.cdoEpoch\n  const { fees, amount } = withdraws || {}\n  const { amount: instantAmount } = instantWithdraws || {}\n  const { FEE: vaultFee } = block.APYs || {}\n\n  const GROSS = BNify(amount).toFixed(0)\n  const FEE = BNify(fees).toFixed(0)\n  const INTEREST = BNify(fees)\n    .times(BNify(vaultFee || 0).minus(1))\n    .toFixed()\n  const NET = BNify(amount)\n    .plus(BNify(instantAmount))\n    .minus(BNify(INTEREST))\n    .toFixed(0)\n\n  return { NET, FEE, INTEREST, GROSS }\n}\n\n/**\n * Get vault block epoch TVL pricipal values\n * @param block - the vault epoch\n * @returns the vault epoch principal values\n */\nexport function getVaultBlockEpochTVLPrincipal(\n  block: VaultBlock\n): VaultEpochPrincipal {\n  if (!block.cdoEpoch) {\n    return {\n      PREVIOUS: '0',\n      DEPOSITS: '0',\n      WITHDRAWALS: '0',\n      PRINCIPAL: '0',\n      DELTA: '0',\n      TOTAL_SUPPLY: '0',\n    }\n  }\n\n  const deposits = block.cdoEpoch.deposits\n  const startTvl = block.TVL?.token || '0'\n\n  // Withdrawals amount\n  const { NET: WITHDRAWALS } = getVaultBlockEpochWithdrawalsBreakdown(block)\n\n  const DEPOSITS = BNify(deposits).toString()\n  const PREVIOUS = BNify(startTvl).minus(DEPOSITS).toString()\n  const PRINCIPAL = BNify(startTvl).plus(WITHDRAWALS).toString()\n  const TOTAL_SUPPLY = BNify(PRINCIPAL).div(block.price).times(1e6).toFixed(0)\n  const DELTA = BNify(PRINCIPAL).minus(PREVIOUS).toString()\n\n  return {\n    PREVIOUS,\n    DEPOSITS,\n    WITHDRAWALS,\n    PRINCIPAL,\n    TOTAL_SUPPLY,\n    DELTA,\n  }\n}\n\n/**\n * Get vault epoch prices by block\n * @param block - the vault block\n * @returns the start, current and end prices\n */\nexport function getVaultBlockEpochPrices(\n  block: VaultBlock,\n  currentDate?: string\n): VaultBlockEpochPrices {\n  if (!block.cdoEpoch) {\n    return { NEGATIVE: '0', START: '0', CURRENT: '0', MIDDLE: '0', END: '0' }\n  }\n\n  // Epoch values\n  const netInterest = block.interest\n    ? block.interest.NET\n    : BNify(block.cdoEpoch.expectedInterest).times(\n        BNify(1).minus(BNify(block.APRs.FEE || 0).div(1e5))\n      )\n  const tvl = block.TVL?.token || 0\n  const duration = block.cdoEpoch.duration\n\n  // Start price of the epoch\n  const START = block.price\n\n  // Calculate negative value\n  const NEGATIVE = BNFixed(BNify(block.price).times(0.8))\n\n  // End price of the epoch\n  const endTVL = BNify(tvl).plus(netInterest)\n  const END = BNFixed(endTVL.times(block.price).div(tvl))\n\n  // Current price of the epoch\n  const elapsedSeconds = moment(currentDate).diff(\n    block.cdoEpoch.startDate,\n    'seconds'\n  )\n  const progressRatio = BigNumber.minimum(\n    1,\n    BNify(elapsedSeconds).div(duration)\n  )\n  const interestIncrease = BNify(END).minus(START).times(progressRatio)\n  const CURRENT = BNFixed(BNify(START).plus(interestIncrease))\n  const MIDDLE = BNify(END).plus(START).div(2).toFixed(0)\n\n  return {\n    NEGATIVE,\n    START,\n    CURRENT,\n    MIDDLE,\n    END,\n  }\n}\n"],"names":["calculateVaultBlockInterestAmounts","compoundVaultApr","filterVaultBlocksPerDay","getEpochWithdrawTypeByBlock","getVaultBlockAPYNet","getVaultBlockCapProgression","getVaultBlockCapStatus","getVaultBlockDepositInterest","getVaultBlockEpochPrices","getVaultBlockEpochProgression","getVaultBlockEpochStatus","getVaultBlockEpochTVLPrincipal","getVaultBlockEpochToWithdraw","getVaultBlockEpochWaitingProgression","getVaultBlockEpochWithdrawType","getVaultBlockEpochWithdrawalsBreakdown","getVaultBlockInterestAmounts","getVaultBlockUnderlyingAmount","getVaultBlockWithdrawableAmount","getVaultCompoundingPeriod","isVaultBlockEpochWithdrawed","makeVaultAPRs","parseAPYs","parseVaultContractAPRs","APRs","integrationsData","APR","BASE","BNify","div","toNumber","vaultContractType","options","feePercentage","totalDuration","compoudingPeriod","grossNetAPR","Number","plus","HARVEST","times","minus","NET","REWARDS","GROSS","toFixed","FEE","APYs","type","rate","compoundPeriod","APY","BNFixed","apr2apy","isFinite","BNgt","MAX_APY","BigNumber","minimum","maximum","integerValue","ROUND_FLOOR","vaultData","integrations","getVaultRewardProgramsApr","block","depositAmount","cdoEpoch","duration","bufferDuration","interests","SECONDS_IN_YEAR","toString","amount","lpBalance","maxWithdrawable","withdrawAmount","balance","BNlte","withdrawableAmount","lpAmount","price","withdrawType","apr","lastApr","instantWithdraws","aprDiff","BNlt","aprDelta","lp","newVaultPrice","scaledAmount","aprPercentage","epochApr","futureLp","futureInterest","date","status","endDate","moment","isAfter","vault","contractLimit","limit","maxCap","undefined","BNeq","isActive","tvl","TVL","withRequestsUSD","delta","tvlProgression","progression","currentTotalSupply","totalSupply","waitingPeriod","startDate","toISOString","add","diff","progress","apyGross","blocks","seenDates","filter","unix","timestamp","format","includes","push","instantWithdrawed","expectedInterest","withdraws","INTEREST","fees","instantAmount","vaultFee","PREVIOUS","DEPOSITS","WITHDRAWALS","PRINCIPAL","DELTA","TOTAL_SUPPLY","deposits","startTvl","token","currentDate","NEGATIVE","START","CURRENT","MIDDLE","END","netInterest","interest","endTVL","elapsedSeconds","progressRatio","interestIncrease"],"mappings":"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"}