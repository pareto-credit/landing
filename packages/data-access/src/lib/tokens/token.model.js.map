{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/tokens/token.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport {\n  ClientEntity,\n  Page,\n  PageSearchQuery,\n  sBCAddress,\n  sBigInt,\n  sClientEntity,\n  sPageSearchQuery,\n} from '../core'\nimport { sWeb3ProtocolContract, Web3ProtocolContract } from '../web3-client'\nimport { TOKENS_ROUTES_KEY } from './token.const'\n\n/**\n * Client Token interface\n */\nexport interface Token extends TokenData, ClientEntity {}\n\nexport function sToken(isPartial?: boolean) {\n  return S.object()\n    .id('#token')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sTokenData(isPartial))\n}\n\nexport interface TokenData {\n  name: string\n  address: string\n  color?: string\n\n  // ETH, etc\n  symbol: string\n  decimals: number\n\n  chainId: string\n\n  // Oracle\n  oracle?: TokenOracle\n}\n\nexport function sTokenData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('name', S.string())\n    .description('The name of the token.')\n    .prop('chainId', S.string())\n    .description('The chainID of the token.')\n    .prop('address', sBCAddress())\n    .description('The blockchain address of the token.')\n    .prop('symbol', S.string())\n    .prop('color', S.string())\n    .prop('decimals', S.number())\n    .prop('oracle', sTokenOracle())\n    .description('Token oracle')\n    .required(\n      isPartial ? [] : ['name', 'chainId', 'address', 'symbol', 'decimals']\n    )\n}\n\nexport interface TokenOracle extends Web3ProtocolContract {\n  USDCAddress?: string\n  wETHAddress?: string\n  stETHAddress?: string\n  USDEAddress?: string\n  MATICAddress?: string\n  ARBAddress?: string\n  OPAddress?: string\n  fee?: number\n}\n\nexport function sTokenOracle() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('USDCAddress', sBCAddress())\n    .prop('wETHAddress', sBCAddress())\n    .prop('stETHAddress', sBCAddress())\n    .prop('USDEAddress', sBCAddress())\n    .prop('ARBAddress', sBCAddress())\n    .prop('OPAddress', sBCAddress())\n    .prop('fee', S.number())\n    .extend(sWeb3ProtocolContract())\n}\n\nexport interface TokenPriceData {\n  price: string\n  decimals: number\n}\n\nexport function sTokenPriceData() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('price', sBigInt())\n    .required()\n    .prop('decimals', S.number())\n    .required()\n}\n\nexport enum TokenErrorCodes {\n  notFound = 'TOKEN_NOT_FOUND',\n  notDeletable = 'TOKEN_NOT_DELETABLE',\n  dataNotValid = 'TOKEN_DATA_NOT_VALID',\n  addressMalformed = 'TOKEN_ADDRESS_MALFORMED',\n}\n\nexport type TokenFields =\n  | '_id'\n  | 'name'\n  | 'chainId'\n  | 'address'\n  | 'symbol'\n  | 'decimals'\n  | 'oracle'\n\nexport const TOKEN_FIELDS = [\n  '_id',\n  'name',\n  'chainId',\n  'address',\n  'symbol',\n  'decimals',\n  'oracle',\n  'createdAt',\n  'createdBy',\n  'updatedAt',\n  'updatedBy',\n]\n\nexport const TOKEN_SORT_FIELDS = ['_id', 'name']\n\nexport interface TokensSearchQuery extends PageSearchQuery<'name'> {\n  name?: string\n  'name:ct'?: string\n  address?: string | string[]\n  symbol?: string\n  chainId?: string\n}\n\nexport function sTokensSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('name', S.string())\n    .description('Name of the token that must match.')\n    .prop('name:ct', S.string())\n    .description('Name of the token that must be contained.')\n    .prop('address', S.array().minItems(1).maxItems(200).items(sBCAddress()))\n    .description('Blockchain address of the token that must match.')\n    .prop('symbol', S.string())\n    .description('Symbol of the token that must match.')\n    .prop('chainId', S.string())\n    .description('ChainID of the token that must match.')\n    .extend(sPageSearchQuery(TOKEN_FIELDS, TOKEN_SORT_FIELDS))\n}\n\nexport interface TokensClientModel {\n  search: (params?: TokensSearchQuery) => Promise<Page<Token>>\n  list: (params?: TokensSearchQuery) => Promise<Token[]>\n  findOne: (params?: TokensSearchQuery) => Promise<Token | undefined>\n  readOne: (params: TokensSearchQuery) => Promise<Token>\n  create: (body: TokenData) => Promise<Token>\n}\n\nexport enum TokenRoutes {\n  v1Create = `v1/${TOKENS_ROUTES_KEY}`,\n  v1Delete = `v1/${TOKENS_ROUTES_KEY}/:tokenId`,\n  v1Read = `v1/${TOKENS_ROUTES_KEY}/:tokenId`,\n  v1Update = `v1/${TOKENS_ROUTES_KEY}/:tokenId`,\n  v1Search = `v1/${TOKENS_ROUTES_KEY}`,\n}\n"],"names":["TOKEN_FIELDS","TOKEN_SORT_FIELDS","sToken","sTokenData","sTokenOracle","sTokenPriceData","sTokensSearchQuery","isPartial","S","object","id","additionalProperties","extend","sClientEntity","prop","string","description","sBCAddress","number","required","sWeb3ProtocolContract","sBigInt","TokenErrorCodes","array","minItems","maxItems","items","sPageSearchQuery","TokenRoutes","TOKENS_ROUTES_KEY"],"mappings":"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"}