{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/users/user.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport {\n  ClientEntity,\n  Page,\n  PageSearchQuery,\n  sClientEntity,\n  sEmail,\n  sPageSearchQuery,\n} from '../core'\nimport { USERS_ROUTES_KEY } from './user.const'\n\n/**\n * Client Vault interface\n */\nexport interface User extends UserData, ClientEntity {}\n\nexport function sUser(isPartial?: boolean) {\n  return S.object()\n    .id('#user')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sUserData(isPartial))\n}\n\nexport interface UserData {\n  name: string\n  email?: string\n  telegram?: UserTelegram\n  credentials?: UserCredentials\n}\n\nexport function sUserData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('name', S.string())\n    .prop('email', sEmail())\n    .prop('telegram', sUserTelegram())\n    .prop('credentials', sUserCredentials())\n    .required(isPartial ? [] : ['name'])\n}\n\nexport interface UserTelegram {\n  userId: number\n  username?: string\n}\n\nexport function sUserTelegram() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('userId', S.number())\n    .required()\n    .prop('username', S.string())\n}\n\nexport interface UserCredentials {\n  username: string\n  password: string\n}\n\nexport function sUserCredentials() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('username', S.string())\n    .required()\n    .prop('password', S.string())\n    .required()\n}\n\nexport enum UserErrorCodes {\n  userCollision = 'USER_COLLISION',\n  notFound = 'USER_NOT_FOUND',\n  notDeletable = 'USER_NOT_DELETABLE',\n  samePassword = 'USER_SAME_PASSWORD',\n  wrongPassword = 'USER_WRONG_PASSWORD',\n}\n\nexport type UserFields =\n  | '_id'\n  | 'name'\n  | 'email'\n  | 'createdAt'\n  | 'createdBy'\n  | 'updatedAt'\n  | 'updatedBy'\n\nexport const USER_FIELDS = [\n  '_id',\n  'name',\n  'email',\n  'createdAt',\n  'createdBy',\n  'updatedAt',\n  'updatedBy',\n]\n\nexport const USER_SORT_FIELDS = ['_id', 'name']\n\nexport enum UserRoutes {\n  v1Create = `v1/${USERS_ROUTES_KEY}`,\n  v1Delete = `v1/${USERS_ROUTES_KEY}/:userId`,\n  v1Read = `v1/${USERS_ROUTES_KEY}/:userId`,\n  v1Update = `v1/${USERS_ROUTES_KEY}/:userId`,\n  v1Search = `v1/${USERS_ROUTES_KEY}`,\n  v1ChangePassword = `v1/${USERS_ROUTES_KEY}/:userId/change-password`,\n}\n\nexport interface UsersSearchQuery extends PageSearchQuery<'name', UserFields> {\n  name?: string\n  'name:ct'?: string\n  email?: string\n}\n\nexport function sUsersSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('name', S.string())\n    .description('Name of the user that must match.')\n    .prop('name:ct', S.string())\n    .description('Name of the user that must be contained.')\n    .prop('email', sEmail())\n    .description('Email of the user that must match.')\n    .extend(sPageSearchQuery(USER_FIELDS, USER_SORT_FIELDS))\n}\n\nexport interface UsersClientModel {\n  findOne: (params?: UsersSearchQuery) => Promise<User | undefined>\n  search: (params?: UsersSearchQuery) => Promise<Page<User>>\n  list: (params?: UsersSearchQuery) => Promise<User[]>\n}\n"],"names":["USER_FIELDS","USER_SORT_FIELDS","sUser","sUserCredentials","sUserData","sUserTelegram","sUsersSearchQuery","isPartial","S","object","id","additionalProperties","extend","sClientEntity","prop","string","sEmail","required","number","UserErrorCodes","UserRoutes","USERS_ROUTES_KEY","description","sPageSearchQuery"],"mappings":";;;;;;;;;;;IAqFaA,WAAW;eAAXA;;IAUAC,gBAAgB;eAAhBA;;;;;;;;IA/EGC,KAAK;eAALA;;IA2CAC,gBAAgB;eAAhBA;;IA5BAC,SAAS;eAATA;;IAeAC,aAAa;eAAbA;;IAkEAC,iBAAiB;eAAjBA;;;;2EAhHF;sBAQP;2BAC0B;AAO1B,SAASJ,MAAMK,SAAmB;IACvC,OAAOC,yBAAC,CAACC,MAAM,GACZC,EAAE,CAAC,SACHC,oBAAoB,CAAC,OACrBC,MAAM,CAACC,IAAAA,mBAAa,EAACN,YACrBK,MAAM,CAACR,UAAUG;AACtB;AASO,SAASH,UAAUG,SAAmB;IAC3C,OAAOC,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQN,yBAAC,CAACO,MAAM,IACrBD,IAAI,CAAC,SAASE,IAAAA,YAAM,KACpBF,IAAI,CAAC,YAAYT,iBACjBS,IAAI,CAAC,eAAeX,oBACpBc,QAAQ,CAACV,YAAY,EAAE,GAAG;QAAC;KAAO;AACvC;AAOO,SAASF;IACd,OAAOG,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,UAAUN,yBAAC,CAACU,MAAM,IACvBD,QAAQ,GACRH,IAAI,CAAC,YAAYN,yBAAC,CAACO,MAAM;AAC9B;AAOO,SAASZ;IACd,OAAOK,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,YAAYN,yBAAC,CAACO,MAAM,IACzBE,QAAQ,GACRH,IAAI,CAAC,YAAYN,yBAAC,CAACO,MAAM,IACzBE,QAAQ;AACb;;UAEYE;;;;;;GAAAA,mBAAAA;AAiBL,MAAMnB,cAAc;IACzB;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAMC,mBAAmB;IAAC;IAAO;CAAO;;UAEnCmB;wCACC,CAAC,GAAG,EAAEC,2BAAgB,CAAC,CAAC;wCACxB,CAAC,GAAG,EAAEA,2BAAgB,CAAC,QAAQ,CAAC;sCAClC,CAAC,GAAG,EAAEA,2BAAgB,CAAC,QAAQ,CAAC;wCAC9B,CAAC,GAAG,EAAEA,2BAAgB,CAAC,QAAQ,CAAC;wCAChC,CAAC,GAAG,EAAEA,2BAAgB,CAAC,CAAC;gDAChB,CAAC,GAAG,EAAEA,2BAAgB,CAAC,wBAAwB,CAAC;GANzDD,eAAAA;AAeL,SAASd;IACd,OAAOE,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQN,yBAAC,CAACO,MAAM,IACrBO,WAAW,CAAC,qCACZR,IAAI,CAAC,WAAWN,yBAAC,CAACO,MAAM,IACxBO,WAAW,CAAC,4CACZR,IAAI,CAAC,SAASE,IAAAA,YAAM,KACpBM,WAAW,CAAC,sCACZV,MAAM,CAACW,IAAAA,sBAAgB,EAACvB,aAAaC;AAC1C"}