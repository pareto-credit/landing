{"version":3,"sources":["../../../../../../../../libs/shared/data-access/src/lib/vaults/classes/vault-best-yield.class.ts"],"sourcesContent":["import { BlockNumber } from '../../core'\nimport { Token } from '../../tokens'\nimport { Web3CallData } from '../../web3-client'\nimport { ensureAbi, getAbiByCode } from '../libs/vault-web3.lib'\nimport {\n  Vault,\n  VaultContractData,\n  VaultContractModel,\n  VaultContractOptions,\n  VaultNonPayableMethodOptions,\n  VaultNonPayableMethodType,\n} from '../vault.model'\nimport { VaultContract } from './vault-contract.class'\n\nexport class VaultBestYield\n  extends VaultContract\n  implements VaultContractModel\n{\n  constructor(vault: Vault, token: Token, options?: VaultContractOptions) {\n    super(vault, token, options)\n  }\n\n  /**\n   * Get contract data\n   * @returns the blockchain contract data\n   */\n  public async getContractData(\n    blockNumber: BlockNumber = 'latest'\n  ): Promise<VaultContractData> {\n    const callData = this.makeCallData(blockNumber)\n    return this.getData(callData, blockNumber)\n  }\n\n  /**\n   * Get vault non payable method\n   * @param type\n   * @param params\n   */\n  public getValue(\n    type: VaultNonPayableMethodType,\n    options?: VaultNonPayableMethodOptions\n  ): Promise<any> {\n    switch (type) {\n      default:\n        throw new Error('Method not available for this kind of vault')\n    }\n  }\n\n  /**\n   * Prepare call data\n   * @returns the web3 call data\n   */\n  protected makeCallData(blockNumber?: BlockNumber): Web3CallData[] {\n    // Parse vault contract methods\n    const {\n      abi: vaultAbi,\n      abiCode,\n      address,\n      protocol,\n      contractType,\n    } = this.vault\n    const abi = ensureAbi({ abi: vaultAbi, abiCode })\n\n    let callData = this.makeProtocolData(\n      { abi, address, protocol },\n      contractType\n    )\n\n    if (this.walletAddresses) {\n      callData = this.walletAddresses.reduce(\n        (acc, walletAddress) => [\n          ...acc,\n          ...this.makeWalletData(walletAddress, { abi, address, protocol }),\n        ],\n        callData\n      )\n    }\n\n    // Parse vault pools methods\n    if (this.vault.pools) {\n      callData = this.vault.pools.reduce(\n        (acc, pool) => [...acc, ...this.makePoolData(pool, blockNumber)],\n        callData\n      )\n    }\n\n    // Parse token methods\n    if (this.token.oracle) {\n      callData = [\n        ...callData,\n        ...this.makeProtocolData(this.token.oracle, 'ORACLE', this.token),\n      ]\n    }\n\n    return callData\n  }\n}\n"],"names":["VaultBestYield","VaultContract","getContractData","blockNumber","callData","makeCallData","getData","getValue","type","options","Error","abi","vaultAbi","abiCode","address","protocol","contractType","vault","ensureAbi","makeProtocolData","walletAddresses","reduce","acc","walletAddress","makeWalletData","pools","pool","makePoolData","token","oracle","constructor"],"mappings":";;;;+BAcaA;;;eAAAA;;;8BAX2B;oCASV;AAEvB,IAAA,AAAMA,iBAAN,MAAMA,uBACHC,iCAAa;IAOrB;;;GAGC,GACD,MAAaC,gBACXC,cAA2B,QAAQ,EACP;QAC5B,MAAMC,WAAW,IAAI,CAACC,YAAY,CAACF;QACnC,OAAO,IAAI,CAACG,OAAO,CAACF,UAAUD;IAChC;IAEA;;;;GAIC,GACD,AAAOI,SACLC,IAA+B,EAC/BC,OAAsC,EACxB;QACd,OAAQD;YACN;gBACE,MAAM,IAAIE,MAAM;QACpB;IACF;IAEA;;;GAGC,GACD,AAAUL,aAAaF,WAAyB,EAAkB;QAChE,+BAA+B;QAC/B,MAAM,EACJQ,KAAKC,QAAQ,EACbC,OAAO,EACPC,OAAO,EACPC,QAAQ,EACRC,YAAY,EACb,GAAG,IAAI,CAACC,KAAK;QACd,MAAMN,MAAMO,IAAAA,uBAAS,EAAC;YAAEP,KAAKC;YAAUC;QAAQ;QAE/C,IAAIT,WAAW,IAAI,CAACe,gBAAgB,CAClC;YAAER;YAAKG;YAASC;QAAS,GACzBC;QAGF,IAAI,IAAI,CAACI,eAAe,EAAE;YACxBhB,WAAW,IAAI,CAACgB,eAAe,CAACC,MAAM,CACpC,CAACC,KAAKC,gBAAkB;uBACnBD;uBACA,IAAI,CAACE,cAAc,CAACD,eAAe;wBAAEZ;wBAAKG;wBAASC;oBAAS;iBAChE,EACDX;QAEJ;QAEA,4BAA4B;QAC5B,IAAI,IAAI,CAACa,KAAK,CAACQ,KAAK,EAAE;YACpBrB,WAAW,IAAI,CAACa,KAAK,CAACQ,KAAK,CAACJ,MAAM,CAChC,CAACC,KAAKI,OAAS;uBAAIJ;uBAAQ,IAAI,CAACK,YAAY,CAACD,MAAMvB;iBAAa,EAChEC;QAEJ;QAEA,sBAAsB;QACtB,IAAI,IAAI,CAACwB,KAAK,CAACC,MAAM,EAAE;YACrBzB,WAAW;mBACNA;mBACA,IAAI,CAACe,gBAAgB,CAAC,IAAI,CAACS,KAAK,CAACC,MAAM,EAAE,UAAU,IAAI,CAACD,KAAK;aACjE;QACH;QAEA,OAAOxB;IACT;IA7EA0B,YAAYb,KAAY,EAAEW,KAAY,EAAEnB,OAA8B,CAAE;QACtE,KAAK,CAACQ,OAAOW,OAAOnB;IACtB;AA4EF"}