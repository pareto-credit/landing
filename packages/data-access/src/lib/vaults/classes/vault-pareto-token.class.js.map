{"version":3,"sources":["../../../../../../../../libs/shared/data-access/src/lib/vaults/classes/vault-pareto-token.class.ts"],"sourcesContent":["import { BlockNumber } from '../../core'\nimport { Token } from '../../tokens'\nimport { Web3CallData } from '../../web3-client'\nimport {\n  Vault,\n  VaultContractData,\n  VaultContractModel,\n  VaultContractOptions,\n  VaultNonPayableMethodOptions,\n  VaultNonPayableMethodType,\n} from '../vault.model'\nimport { VaultContract } from './vault-contract.class'\nimport { ensureAbi } from '../libs/vault-web3.lib'\n\nexport class VaultParetoToken\n  extends VaultContract\n  implements VaultContractModel\n{\n  constructor(vault: Vault, token: Token, options?: VaultContractOptions) {\n    super(vault, token, options)\n  }\n\n  /**\n   * Get contract data\n   * @returns the blockchain contract data\n   */\n  public async getContractData(\n    blockNumber: BlockNumber = 'latest'\n  ): Promise<VaultContractData> {\n    const callData = this.makeCallData(blockNumber)\n    return this.getData(callData, blockNumber)\n  }\n\n  /**\n   * Prepare call data\n   * @returns the web3 call data\n   */\n  protected makeCallData(blockNumber?: BlockNumber): Web3CallData[] {\n    // Parse vault contract methods\n    const {\n      abi: vaultAbi,\n      abiCode,\n      address,\n      protocol,\n      contractType,\n    } = this.vault\n    const abi = ensureAbi({ abi: vaultAbi, abiCode })\n    const callData = this.makeProtocolData(\n      { abi, address, protocol },\n      contractType\n    )\n\n    return callData\n  }\n\n  /**\n   * Get vault non payable method\n   * @param type\n   * @param params\n   */\n  public getValue(\n    type: VaultNonPayableMethodType,\n    options?: VaultNonPayableMethodOptions\n  ): Promise<any> {\n    try {\n      switch (type) {\n        default:\n          throw new Error('Value not available for this kind of vault')\n      }\n    } catch (error) {\n      console.error(`Contract get value error`, type, error)\n      return Promise.resolve(null)\n    }\n  }\n\n  /**\n   * Check if wallet is allowed\n   * @param options - the method options\n   * @returns true if wallet is allowed\n   */\n  public isWalletAllowed(\n    options?: VaultNonPayableMethodOptions\n  ): Promise<boolean> {\n    try {\n      if (\n        this.vault.contractType !== 'PARETO_TOKEN' ||\n        !this.vault.paretoDollar\n      ) {\n        throw Error('Wrong vault type')\n      }\n\n      if (options?.walletAddress === undefined) {\n        throw Error('Wallet address is mandatory')\n      }\n\n      const { abi: vaultAbi, abiCode, address } = this.vault\n      const abi = ensureAbi({ abi: vaultAbi, abiCode })\n      const method = this.getContractNonPayableMethod({\n        abi,\n        address,\n        method: 'isWalletAllowed',\n        params: [options.walletAddress],\n      })\n\n      if (!method) {\n        throw Error('Not method available')\n      }\n\n      return method.call<boolean>()\n    } catch (error) {\n      return Promise.resolve(false)\n    }\n  }\n}\n"],"names":["VaultParetoToken","VaultContract","getContractData","blockNumber","callData","makeCallData","getData","abi","vaultAbi","abiCode","address","protocol","contractType","vault","ensureAbi","makeProtocolData","getValue","type","options","Error","error","console","Promise","resolve","isWalletAllowed","paretoDollar","walletAddress","undefined","method","getContractNonPayableMethod","params","call","constructor","token"],"mappings":";;;;+BAcaA;;;eAAAA;;;oCAHiB;8BACJ;AAEnB,IAAA,AAAMA,mBAAN,MAAMA,yBACHC,iCAAa;IAOrB;;;GAGC,GACD,MAAaC,gBACXC,cAA2B,QAAQ,EACP;QAC5B,MAAMC,WAAW,IAAI,CAACC,YAAY,CAACF;QACnC,OAAO,IAAI,CAACG,OAAO,CAACF,UAAUD;IAChC;IAEA;;;GAGC,GACD,AAAUE,aAAaF,WAAyB,EAAkB;QAChE,+BAA+B;QAC/B,MAAM,EACJI,KAAKC,QAAQ,EACbC,OAAO,EACPC,OAAO,EACPC,QAAQ,EACRC,YAAY,EACb,GAAG,IAAI,CAACC,KAAK;QACd,MAAMN,MAAMO,IAAAA,uBAAS,EAAC;YAAEP,KAAKC;YAAUC;QAAQ;QAC/C,MAAML,WAAW,IAAI,CAACW,gBAAgB,CACpC;YAAER;YAAKG;YAASC;QAAS,GACzBC;QAGF,OAAOR;IACT;IAEA;;;;GAIC,GACD,AAAOY,SACLC,IAA+B,EAC/BC,OAAsC,EACxB;QACd,IAAI;YACF,OAAQD;gBACN;oBACE,MAAM,IAAIE,MAAM;YACpB;QACF,EAAE,OAAOC,OAAO;YACdC,QAAQD,KAAK,CAAC,CAAC,wBAAwB,CAAC,EAAEH,MAAMG;YAChD,OAAOE,QAAQC,OAAO,CAAC;QACzB;IACF;IAEA;;;;GAIC,GACD,AAAOC,gBACLN,OAAsC,EACpB;QAClB,IAAI;YACF,IACE,IAAI,CAACL,KAAK,CAACD,YAAY,KAAK,kBAC5B,CAAC,IAAI,CAACC,KAAK,CAACY,YAAY,EACxB;gBACA,MAAMN,MAAM;YACd;YAEA,IAAID,CAAAA,2BAAAA,QAASQ,aAAa,MAAKC,WAAW;gBACxC,MAAMR,MAAM;YACd;YAEA,MAAM,EAAEZ,KAAKC,QAAQ,EAAEC,OAAO,EAAEC,OAAO,EAAE,GAAG,IAAI,CAACG,KAAK;YACtD,MAAMN,MAAMO,IAAAA,uBAAS,EAAC;gBAAEP,KAAKC;gBAAUC;YAAQ;YAC/C,MAAMmB,SAAS,IAAI,CAACC,2BAA2B,CAAC;gBAC9CtB;gBACAG;gBACAkB,QAAQ;gBACRE,QAAQ;oBAACZ,QAAQQ,aAAa;iBAAC;YACjC;YAEA,IAAI,CAACE,QAAQ;gBACX,MAAMT,MAAM;YACd;YAEA,OAAOS,OAAOG,IAAI;QACpB,EAAE,OAAOX,OAAO;YACd,OAAOE,QAAQC,OAAO,CAAC;QACzB;IACF;IA9FAS,YAAYnB,KAAY,EAAEoB,KAAY,EAAEf,OAA8B,CAAE;QACtE,KAAK,CAACL,OAAOoB,OAAOf;IACtB;AA6FF"}