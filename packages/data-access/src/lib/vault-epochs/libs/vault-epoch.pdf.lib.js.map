{"version":3,"sources":["../../../../../../../../libs/shared/data-access/src/lib/vault-epochs/libs/vault-epoch.pdf.lib.ts"],"sourcesContent":["import moment from 'moment'\nimport { sanitizeHtml, WalletEpochStats } from '../../vaults'\nimport {\n  BNFixed,\n  BNify,\n  compLower,\n  makeHashLink,\n  numberFormat,\n  secondsToPeriod,\n  shortHash,\n} from '../../core'\nimport {\n  MovementRow,\n  VaultEpoch,\n  VaultEpochAPRs,\n  VaultEpochAPYs,\n  VaultEpochInterest,\n} from '../vault-epoch.model'\nimport { fixAmount } from '../../tokens'\nimport {\n  getVaultEpochsPrincipalAmounts,\n  getVaultEpochWithdrawalTxBreakdown,\n} from './vault-epoch.lib'\nimport { Transaction } from '../../transactions'\nimport { Operator } from '../../operators'\n\nexport function getLPLabel(\n  name: string | undefined,\n  address: string,\n  chainHex?: string\n) {\n  const hashLabel = `(${shortHash(address || '')})`\n  const hashLink = chainHex\n    ? `<a href=\"${makeHashLink(\n        'address',\n        address,\n        chainHex\n      )}\" target=\"_blank\">${hashLabel}</a>`\n    : hashLabel\n  return `${name ? name : 'Unknown'} ${hashLink}`\n}\n\nexport function buildEpochMovementsTable(\n  deposits: MovementRow[],\n  withdraws: MovementRow[]\n) {\n  const rows: string[] = []\n\n  if (deposits.length) {\n    rows.push('<tr class=\"section-header\"><th colspan=\"2\">Deposits</th></tr>')\n    deposits.forEach((row) => {\n      const safeLabel = sanitizeHtml(row.label)\n      const safeAmount = sanitizeHtml(row.amount)\n      rows.push(\n        `<tr><td>${safeLabel}</td><td class=\"value\">${safeAmount}</td></tr>`\n      )\n    })\n  }\n\n  if (withdraws.length) {\n    rows.push('<tr class=\"section-header\"><th colspan=\"2\">Withdraws</th></tr>')\n    withdraws.forEach((row) => {\n      const valueClass = row.variant === 'negative' ? 'value negative' : 'value'\n      const safeLabel = sanitizeHtml(row.label)\n      const safeAmount = sanitizeHtml(row.amount)\n      rows.push(\n        `<tr><td>${safeLabel}</td><td class=\"${valueClass}\">${safeAmount}</td></tr>`\n      )\n    })\n  }\n\n  return `<table class=\"movements-table\"><tbody>${rows.join(\n    ''\n  )}</tbody></table>`\n}\n\nexport function formatPeriodRange(startDate: string, endDate: string) {\n  return `${formatDate(startDate)} - ${formatDate(endDate)}`\n}\n\nexport function formatDate(value?: string, format = 'MMMM Do, YYYY') {\n  if (!value) {\n    return '-'\n  }\n  return moment(value).format(format)\n}\n\nexport function buildEpochStatsTable({\n  bufferDuration,\n  duration,\n  APRs,\n  APYs,\n  interest,\n}: {\n  bufferDuration: number\n  duration: number\n  APRs: VaultEpochAPRs\n  APYs?: VaultEpochAPYs\n  interest?: VaultEpochInterest\n}) {\n  const { duration: cycleDuration, unit: cycleUnit } = secondsToPeriod(duration)\n  const { duration: bufferDurationValue, unit: bufferUnit } =\n    secondsToPeriod(bufferDuration)\n\n  const grossAPR = numberFormat(Number(APRs.GROSS) / 100, {\n    style: 'percent',\n    maximumFractionDigits: 2,\n  })\n  const netAPY = numberFormat(Number(APYs?.NET || 0) / 100, {\n    style: 'percent',\n    maximumFractionDigits: 2,\n  })\n\n  const rows = [\n    { label: 'Buffer Duration', value: `${bufferDurationValue} ${bufferUnit}` },\n    { label: 'Duration', value: `${cycleDuration} ${cycleUnit}` },\n    { label: 'Gross APR', value: grossAPR },\n    { label: 'Net APY', value: netAPY },\n  ]\n    .map(\n      (row) =>\n        `<tr><td>${sanitizeHtml(\n          row.label\n        )}</td><td class=\"value\">${sanitizeHtml(row.value)}</td></tr>`\n    )\n    .join('')\n\n  return `<table class=\"cycle-stats-table\"><tbody>${rows}</tbody></table>`\n}\n\nexport function buildInflowsOutflowsTable(\n  chainHex: string,\n  transactions: Transaction[],\n  epoch: VaultEpoch,\n  walletNames: Record<string, string | undefined>,\n  vaultToken: {\n    symbol: string\n    decimals: number\n  },\n  underlyingToken: {\n    symbol: string\n    decimals: number\n  }\n) {\n  const renderRow = (tx: Transaction) => {\n    const walletId = tx.walletId || ''\n    const label = getLPLabel(walletNames[walletId], tx.walletAddress, chainHex)\n\n    const timestamp = new Date(tx.block.timestamp * 1000).toISOString()\n    const date = formatDate(timestamp, 'LLL')\n    const underlyingAmount = formatTokenAmount(\n      tx.tokenAmount,\n      underlyingToken.decimals\n    )\n\n    return `\n    <tr>\n      <td><a href=\"${makeHashLink(\n        'tx',\n        tx.hash,\n        chainHex\n      )}\" target=\"_blank\">${date}</a></td>\n      <td>${label}</td>\n      <td class=\"value\">${underlyingAmount}</td>\n    </tr>`\n  }\n\n  const header = `\n  <thead>\n    <tr>\n      <th width=\"180\">Date</th>\n      <th>LP</th>\n      <th class=\"value\">Amount</th>\n    </tr>\n  </thead>`\n\n  /**\n   * PARSE TRANSACTIONS TO APPLY THE CORRECT AMOUNT\n   */\n  const stopTx = transactions.find((t) => t.type === 'STOP_EPOCH')\n  transactions = transactions.map((tx) => {\n    if (!stopTx || tx.type !== 'REQUEST_WITHDRAW') {\n      return tx\n    }\n\n    // Get correct token final amount\n    const { NET: tokenAmount } = getVaultEpochWithdrawalTxBreakdown(\n      epoch,\n      tx,\n      stopTx.price\n    )\n\n    return {\n      ...tx,\n      tokenAmount,\n    }\n  })\n  /**\n   * END PARSING\n   */\n\n  const inflowsRows = transactions\n    .filter((tx) => ['DEPOSIT', 'REQUEST_DEPOSIT'].includes(tx.type))\n    .map(renderRow)\n\n  const inflowsTotals = transactions\n    .filter((tx) => ['DEPOSIT', 'REQUEST_DEPOSIT'].includes(tx.type))\n    .reduce(\n      (acc, tx) => ({\n        lpAmount: acc.lpAmount.plus(tx.amount),\n        underlyingAmount: acc.underlyingAmount.plus(tx.tokenAmount),\n      }),\n      {\n        lpAmount: BNify(0),\n        underlyingAmount: BNify(0),\n      }\n    )\n\n  const outflowsRows = transactions\n    .filter((tx) => ['REDEEM', 'REQUEST_WITHDRAW'].includes(tx.type))\n    .map(renderRow)\n\n  const outflowsTotals = transactions\n    .filter((tx) => ['REDEEM', 'REQUEST_WITHDRAW'].includes(tx.type))\n    .reduce(\n      (acc, tx) => ({\n        lpAmount: acc.lpAmount.plus(tx.amount),\n        underlyingAmount: acc.underlyingAmount.plus(tx.tokenAmount),\n      }),\n      {\n        lpAmount: BNify(0),\n        underlyingAmount: BNify(0),\n      }\n    )\n\n  const inflowsTotalRows = `\n    <tr class=\"total\">\n      <td colspan=\"2\">Total inflows</td>\n      <td class=\"value\">${formatTokenAmount(\n        inflowsTotals.underlyingAmount,\n        underlyingToken.decimals\n      )}</td>\n    </tr>`\n\n  const outflowsTotalRows = `\n    <tr class=\"total\">\n      <td colspan=\"2\">Total outflows</td>\n      <td class=\"value\">${formatTokenAmount(\n        outflowsTotals.underlyingAmount,\n        underlyingToken.decimals\n      )}</td>\n    </tr>`\n\n  const inflowsTable = `<table class=\"inflows-outflows-table\">${header}<tbody>${\n    inflowsRows.length\n      ? inflowsRows.join('') + inflowsTotalRows\n      : '<tr><td colspan=\"3\">No inflows during this cycle</td></tr>'\n  }</tbody></table>`\n  const outflowsTable = `<table class=\"inflows-outflows-table\">${header}<tbody>${\n    outflowsRows.length\n      ? outflowsRows.join('') + outflowsTotalRows\n      : '<tr><td colspan=\"3\">No outflows during this cycle</td></tr>'\n  }</tbody></table>`\n\n  return `\n  <h2>Inflows</h2>\n  ${inflowsTable}\n  <h2>Outflows</h2>\n  ${outflowsTable}\n  `\n}\n\nexport function buildEpochPrincipalBreakdownTable(\n  epochs: {\n    current: VaultEpoch\n    previous?: VaultEpoch\n  },\n  decimals: number\n) {\n  const { current: currentEpoch, previous: previousEpoch } = epochs\n  const { PREVIOUS, INTEREST, WITHDRAWALS, DEPOSITS, PRINCIPAL, DELTA } =\n    getVaultEpochsPrincipalAmounts(currentEpoch, previousEpoch)\n\n  const withdrawals = formatTokenAmount(WITHDRAWALS, decimals)\n  const deposits = formatTokenAmount(DEPOSITS, decimals)\n  const previous = formatTokenAmount(PREVIOUS, decimals)\n  const current = formatTokenAmount(PRINCIPAL, decimals)\n  const delta = formatTokenAmount(DELTA, decimals)\n  const interest = formatTokenAmount(INTEREST, decimals)\n\n  return `<table>\n      <tbody>\n        <tr class=\"total\">\n          <td>Beginning Principal Amount</td>\n          <td class=\"value\">${previous}</td>\n        </tr>\n        <tr>\n          <td>Reinvested Interest from Lenders</td>\n          <td class=\"value\">${interest}</td>\n        </tr>\n        <tr>\n          <td>Withdrawals Processed</td>\n          <td class=\"value\">${withdrawals}</td>\n        </tr>\n        <tr>\n          <td>Deposits Processed</td>\n          <td class=\"value\">${deposits}</td>\n        </tr>\n        <tr class=\"total\">\n          <td>New Principal Amount (Loan Notice Amount)</td>\n          <td class=\"value\">${current}</td>\n        </tr>\n        <tr class=\"total\">\n          <td>Total %{borrowerName} Receiving/Returning</td>\n          <td class=\"value\">${delta}</td>\n        </tr>\n      </tbody>\n    </table>`\n}\n\nexport function formatTokenAmount(value: any, decimals: number) {\n  const parsed = fixAmount(value, decimals).toNumber()\n  return numberFormat(parsed, {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  })\n}\n\nexport function formatNegativeAmount(value: any, decimals: number) {\n  const parsed = fixAmount(value, decimals).toNumber()\n  if (parsed === 0) {\n    return formatTokenAmount(0, decimals)\n  }\n  const formatted = numberFormat(Math.abs(parsed), {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  })\n  return `-${formatted}`\n}\n\nexport function buildEpochInterestBreakdownTable(\n  vaultEpoch: VaultEpoch,\n  token: {\n    symbol: string\n    decimals: number\n  },\n  options: {\n    curator?: Operator\n  }\n) {\n  const { curator } = options\n  const withdrawsFees = formatNegativeAmount(\n    BNify(vaultEpoch.withdraws?.fees || '0'),\n    token.decimals\n  )\n  const cycleFees = formatNegativeAmount(\n    BNify(vaultEpoch.interest?.FEE).minus(\n      BNify(vaultEpoch.withdraws?.fees || '0')\n    ),\n    token.decimals\n  )\n\n  const gross = formatTokenAmount(\n    vaultEpoch.interest?.GROSS || '0',\n    token.decimals\n  )\n  const net = formatTokenAmount(vaultEpoch.interest?.NET || '0', token.decimals)\n\n  return `<table>\n      <tbody>\n        <tr>\n          <td>Gross Interest Due from %{borrowerName}</td>\n          <td class=\"value\">${gross}</td>\n        </tr>\n        <tr>\n          <td>Withdrawals fees</td>\n          <td class=\"value\">${withdrawsFees}</td>\n        </tr>\n        <tr>\n          <td>%{performanceFee}% Performance Fee Paid to Pareto${\n            curator && !compLower(curator.name, 'pareto')\n              ? `/${sanitizeHtml(curator.name)}`\n              : ''\n          }</td>\n          <td class=\"value\">${cycleFees}</td>\n        </tr>\n        <tr class=\"total\">\n          <td>Net interest to Lenders</td>\n          <td class=\"value\">${net}</td>\n        </tr>\n      </tbody>\n    </table>`\n}\n\nexport function buildEpochHoldersTable(\n  currEpochHolders: WalletEpochStats[],\n  walletNames: Record<string, string | undefined>,\n  tokenMeta: { decimals: number },\n  chainHex?: string\n) {\n  const holderRows = currEpochHolders\n    .filter((holder) => holder.endBalance && BNify(holder.endBalance).gt(0))\n    .map((currentHolder) => {\n      const walletId = currentHolder.walletBlock.walletId\n      const referenceBlock = currentHolder.walletBlock\n      const label = getLPLabel(\n        walletNames[walletId],\n        referenceBlock?.walletAddress,\n        chainHex\n      )\n\n      const startBalanceValue = BNFixed(currentHolder?.startBalance || '0')\n      const startBalance = formatTokenAmount(\n        startBalanceValue,\n        tokenMeta.decimals\n      )\n\n      const endBalanceRaw = currentHolder.endBalance\n      const endBalanceValue = BNFixed(endBalanceRaw)\n      const endBalance = formatTokenAmount(endBalanceValue, tokenMeta.decimals)\n\n      const interestValue = BNFixed(currentHolder?.earnings?.NET || '0')\n      const interest = formatTokenAmount(interestValue, tokenMeta.decimals)\n      const feeValue = BNFixed(currentHolder?.earnings?.FEE || '0')\n      const fee = formatTokenAmount(feeValue, tokenMeta.decimals)\n\n      return {\n        label,\n        startBalance,\n        endBalance,\n        interest,\n        fee,\n        balanceSortValue: BNify(endBalanceRaw),\n      }\n    })\n    .sort((a, b) => {\n      const diff = b.balanceSortValue.comparedTo(a.balanceSortValue)\n      if (diff !== null) {\n        return diff\n      }\n      return a.label.localeCompare(b.label)\n    })\n\n  const header = `\n    <tr>\n      <th>LP</th>\n      <th class=\"value\">Start balance</th>\n      <th class=\"value\">End balance</th>\n      <th class=\"value\">Interest</th>\n      <th class=\"value\">Fee</th>\n    </tr>`\n\n  const body = holderRows.length\n    ? holderRows\n        .map(\n          (row) => `\n    <tr>\n      <td>${row.label}</td>\n      <td class=\"value\">${row.startBalance}</td>\n      <td class=\"value\">${row.endBalance}</td>\n      <td class=\"value\">${row.interest}</td>\n      <td class=\"value\">${row.fee}</td>\n    </tr>`\n        )\n        .join('')\n    : '<tr><td colspan=\"5\" class=\"empty\">No LP data available</td></tr>'\n\n  return `<table class=\"holders-table\"><thead>${header}</thead><tbody>${body}</tbody></table>`\n}\n"],"names":["buildEpochHoldersTable","buildEpochInterestBreakdownTable","buildEpochMovementsTable","buildEpochPrincipalBreakdownTable","buildEpochStatsTable","buildInflowsOutflowsTable","formatDate","formatNegativeAmount","formatPeriodRange","formatTokenAmount","getLPLabel","name","address","chainHex","hashLabel","shortHash","hashLink","makeHashLink","deposits","withdraws","rows","length","push","forEach","row","safeLabel","sanitizeHtml","label","safeAmount","amount","valueClass","variant","join","startDate","endDate","value","format","moment","bufferDuration","duration","APRs","APYs","interest","cycleDuration","unit","cycleUnit","secondsToPeriod","bufferDurationValue","bufferUnit","grossAPR","numberFormat","Number","GROSS","style","maximumFractionDigits","netAPY","NET","map","transactions","epoch","walletNames","vaultToken","underlyingToken","renderRow","tx","walletId","walletAddress","timestamp","Date","block","toISOString","date","underlyingAmount","tokenAmount","decimals","hash","header","stopTx","find","t","type","getVaultEpochWithdrawalTxBreakdown","price","inflowsRows","filter","includes","inflowsTotals","reduce","acc","lpAmount","plus","BNify","outflowsRows","outflowsTotals","inflowsTotalRows","outflowsTotalRows","inflowsTable","outflowsTable","epochs","current","currentEpoch","previous","previousEpoch","PREVIOUS","INTEREST","WITHDRAWALS","DEPOSITS","PRINCIPAL","DELTA","getVaultEpochsPrincipalAmounts","withdrawals","delta","parsed","fixAmount","toNumber","minimumFractionDigits","formatted","Math","abs","vaultEpoch","token","options","curator","withdrawsFees","fees","cycleFees","FEE","minus","gross","net","compLower","currEpochHolders","tokenMeta","holderRows","holder","endBalance","gt","currentHolder","walletBlock","referenceBlock","startBalanceValue","BNFixed","startBalance","endBalanceRaw","endBalanceValue","interestValue","earnings","feeValue","fee","balanceSortValue","sort","a","b","diff","comparedTo","localeCompare","body"],"mappings":"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"}