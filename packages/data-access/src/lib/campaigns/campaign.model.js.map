{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/campaigns/campaign.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport {\n  ClientEntity,\n  Locales,\n  sClientEntity,\n  sDateString,\n  sLocales,\n  sStringId,\n  UnitTime,\n  sUnitTime,\n  PageSearchQuery,\n  Page,\n  sPageSearchQuery,\n  sBCAddress,\n} from '../core'\nimport {\n  CAMPAIGN_FIELDS,\n  CAMPAIGN_SORT_FIELDS,\n  CAMPAIGNS_ROUTES_KEY,\n} from './campaign.const'\n\n/**\n * Client Vault interface\n */\nexport interface Campaign extends CampaignData, ClientEntity {}\n\nexport function sCampaign(isPartial?: boolean) {\n  return S.object()\n    .id('#campaign')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sCampaignData(isPartial))\n}\n\nexport interface CampaignData {\n  code: string\n  name: Locales\n  description?: Locales\n  rules?: CampaignRule[]\n  referrals?: CampaignReferral[]\n  galxeId?: number\n  startDate?: string\n  endDate?: string\n  link?: string\n}\n\nexport function sCampaignData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', S.string())\n    .prop('name', sLocales())\n    .prop('description', sLocales())\n    .prop('rules', S.array().items(sCampaignRule()))\n    .prop('referrals', S.array().items(sCampaignReferral()))\n    .prop('startDate', sDateString())\n    .prop('endDate', sDateString())\n    .prop('link', S.string())\n    .prop('galxeId', S.number())\n    .required(isPartial ? [] : ['code', 'name'])\n}\n\nexport interface CampaignRule {\n  // Rule info\n  name: Locales\n  description?: Locales\n\n  // Trigger rule: deposit or other kind of transaction\n  trigger: CampaignRuleTrigger\n\n  // Deposit type: for amount or timing\n  deposit: CampaignRuleDeposit\n\n  // Reward type: fixed amount or multiplier\n  reward: CampaignRuleReward\n\n  // Distribution frequency: every day or every x time\n  frequency: CampaignRuleFrequency\n}\n\nexport function sCampaignRule() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('name', sLocales())\n    .required()\n    .prop('description', sLocales())\n    .prop('trigger', sCampaignRuleTrigger())\n    .required()\n    .prop('deposit', sCampaignRuleDeposit())\n    .required()\n    .prop('reward', sCampaignRuleReward())\n    .required()\n    .prop('frequency', sCampaignRuleFrequency())\n    .required()\n}\n\nexport type CampaignRuleTrigger = 'DEPOSIT' | 'DEPOSIT_REQUEST'\n\nexport function sCampaignRuleTrigger() {\n  return S.string().enum(['DEPOSIT', 'DEPOSIT_REQUEST'])\n}\n\nexport interface CampaignRuleDeposit {\n  type: CampaignRuleDepositType\n  value: number\n}\n\nexport function sCampaignRuleDeposit() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('type', sCampaignRuleDepositType())\n    .required()\n    .prop('value', S.number())\n    .required()\n}\n\nexport type CampaignRuleDepositType = 'BALANCE' | 'AGE'\n\nexport function sCampaignRuleDepositType() {\n  return S.string().enum(['BALANCE', 'AGE'])\n}\n\nexport interface CampaignRuleReward {\n  type: CampaignRuleRewardType\n  value: number\n}\n\nexport function sCampaignRuleReward() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('type', sCampaignRuleRewardType())\n    .required()\n    .prop('value', S.number())\n    .required()\n}\n\nexport type CampaignRuleRewardType = 'AMOUNT' | 'MULTIPLIER'\n\nexport function sCampaignRuleRewardType() {\n  return S.string().enum(['AMOUNT', 'MULTIPLIER'])\n}\n\nexport interface CampaignRuleFrequency {\n  value: number\n  unit: UnitTime\n}\n\nexport function sCampaignRuleFrequency() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('value', S.number())\n    .required()\n    .prop('unit', sUnitTime())\n    .required()\n}\n\nexport interface CampaignReferral {\n  code: string\n  isActive: boolean\n}\n\nexport function sCampaignReferral() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', sCampaignReferralCode())\n    .required()\n    .prop('isActive', S.boolean())\n    .required()\n}\n\nexport function sCampaignReferralCode() {\n  return S.string().minLength(6).maxLength(8).pattern('^[a-zA-Z0-9]*$')\n}\n\nexport interface CampaignsSearchQuery extends PageSearchQuery {\n  code?: string | string[]\n  startDate?: string\n  'startDate:lt'?: string\n  'startDate:lte'?: string\n  'startDate:gt'?: string\n  'startDate:gte'?: string\n  endDate?: string\n  'endDate:lt'?: string\n  'endDate:lte'?: string\n  'endDate:gt'?: string\n  'endDate:gte'?: string\n}\n\nexport function sCampaignsSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('tokenId', S.array().maxItems(200).items(sStringId()))\n    .description('The token IDentifier')\n    .prop('startDate', sDateString())\n    .description('The epoch start date equal than')\n    .prop('startDate:lt', sDateString())\n    .description('The epoch start date less than')\n    .prop('startDate:lte', sDateString())\n    .description('The epoch start date less or equal than')\n    .prop('startDate:gt', sDateString())\n    .description('The epoch start date greater than')\n    .prop('startDate:gte', sDateString())\n    .description('The epoch start date greater or equal than')\n    .prop('endDate', sDateString())\n    .description('The epoch end date equal than')\n    .prop('endDate:lt', sDateString())\n    .description('The epoch start date equal than')\n    .prop('endDate:lte', sDateString())\n    .description('The epoch start date equal than')\n    .prop('endDate:gt', sDateString())\n    .description('The epoch start date equal than')\n    .prop('endDate:gte', sDateString())\n    .description('The epoch start date equal than')\n    .extend(sPageSearchQuery(CAMPAIGN_FIELDS, CAMPAIGN_SORT_FIELDS))\n}\n\nexport interface CampaignsClientModel {\n  create: (body: CampaignData) => Promise<Campaign>\n  search: (params?: CampaignsSearchQuery) => Promise<Page<Campaign>>\n  searchAll: (params?: CampaignsSearchQuery) => Promise<Page<Campaign>>\n  list: (params?: CampaignsSearchQuery) => Promise<Campaign[]>\n  listAll: (params?: CampaignsSearchQuery) => Promise<Campaign[]>\n  findOne: (params?: CampaignsSearchQuery) => Promise<Campaign | undefined>\n}\n\nexport enum CampaignRoutes {\n  v1Create = `v1/${CAMPAIGNS_ROUTES_KEY}`,\n  v1Delete = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId`,\n  v1Read = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId`,\n  v1Update = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId`,\n  v1Search = `v1/${CAMPAIGNS_ROUTES_KEY}`,\n  v1Points = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId/points`,\n}\n\nexport enum CampaignErrorCodes {\n  notFound = 'CAMPAIGN_NOT_FOUND',\n  notDeletable = 'CAMPAIGN_NOT_DELETABLE',\n  walletRequired = 'WALLET_REQUIRED',\n  referralCodeNotActive = 'REFERRAL_CODE_NOT_ACTIVE',\n}\n\nexport interface CampaignPointsQuery {\n  walletId?: string\n  walletAddress?: string\n}\n\nexport function sCampaignPointsQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletId', sStringId())\n    .description('Wallet Identifier')\n    .prop('walletAddress', sBCAddress())\n    .description('Wallet address')\n}\n\nexport interface CampaignPoints extends CampaignMetrics {\n  vaults?: CampaignPointsVault[]\n  metrics?: { [key: string]: string | number }\n}\n\nexport function sCampaignPoints() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('vaults', S.array().items(sCampaignPointsVault()))\n    .prop('metrics', sCampaignPointsMetrics())\n    .extend(sCampaignMetrics())\n}\n\nexport interface CampaignPointsVault extends CampaignMetrics {\n  _id: string\n}\n\nexport function sCampaignPointsVault() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('_id', sStringId())\n    .required()\n    .extend(sCampaignMetrics())\n}\n\nexport function sCampaignPointsMetrics() {\n  return S.object().additionalProperties(true)\n}\n\nexport interface CampaignMetrics {\n  points: string\n  perDay: string\n  multiplier: string\n}\n\nexport function sCampaignMetrics() {\n  return S.object()\n    .prop('points', S.string())\n    .required()\n    .prop('perDay', S.string())\n    .required()\n    .prop('multiplier', S.string())\n    .required()\n}\n"],"names":["S","sClientEntity","sDateString","sLocales","sStringId","sUnitTime","sPageSearchQuery","sBCAddress","CAMPAIGN_FIELDS","CAMPAIGN_SORT_FIELDS","CAMPAIGNS_ROUTES_KEY","sCampaign","isPartial","object","id","additionalProperties","extend","sCampaignData","prop","string","array","items","sCampaignRule","sCampaignReferral","number","required","sCampaignRuleTrigger","sCampaignRuleDeposit","sCampaignRuleReward","sCampaignRuleFrequency","enum","sCampaignRuleDepositType","sCampaignRuleRewardType","sCampaignReferralCode","boolean","minLength","maxLength","pattern","sCampaignsSearchQuery","maxItems","description","CampaignRoutes","CampaignErrorCodes","sCampaignPointsQuery","sCampaignPoints","sCampaignPointsVault","sCampaignPointsMetrics","sCampaignMetrics"],"mappings":"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"}