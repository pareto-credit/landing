{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/campaigns/campaign.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport {\n  ClientEntity,\n  Locales,\n  sClientEntity,\n  sDateString,\n  sLocales,\n  sStringId,\n  UnitTime,\n  sUnitTime,\n  PageSearchQuery,\n  Page,\n  sPageSearchQuery,\n  sBCAddress,\n} from '../core'\nimport {\n  CAMPAIGN_FIELDS,\n  CAMPAIGN_SORT_FIELDS,\n  CAMPAIGNS_ROUTES_KEY,\n} from './campaign.const'\n\n/**\n * Client Vault interface\n */\nexport interface Campaign extends CampaignData, ClientEntity {}\n\nexport function sCampaign(isPartial?: boolean) {\n  return S.object()\n    .id('#campaign')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sCampaignData(isPartial))\n}\n\nexport interface CampaignData {\n  code: string\n  name: Locales\n  description?: Locales\n  rules?: CampaignRule[]\n  referrals?: CampaignReferral[]\n  boosts?: CampaignBoost[]\n  galxeId?: number\n  startDate?: string\n  endDate?: string\n  link?: string\n}\n\nexport function sCampaignData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', S.string())\n    .prop('name', sLocales())\n    .prop('description', sLocales())\n    .prop('rules', S.array().items(sCampaignRule()))\n    .prop('referrals', S.array().items(sCampaignReferral()))\n    .prop('boosts', S.array().items(sCampaignBoost()))\n    .prop('startDate', sDateString())\n    .prop('endDate', sDateString())\n    .prop('link', S.string())\n    .prop('galxeId', S.number())\n    .required(isPartial ? [] : ['code', 'name'])\n}\n\nexport interface CampaignRule {\n  // Rule info\n  name: Locales\n  description?: Locales\n\n  // Trigger rule: deposit or other kind of transaction\n  trigger: CampaignRuleTrigger\n\n  // Deposit type: for amount or timing\n  deposit: CampaignRuleDeposit\n\n  // Reward type: fixed amount or multiplier\n  reward: CampaignReward\n\n  // Distribution frequency: every day or every x time\n  frequency: CampaignRuleFrequency\n}\n\nexport function sCampaignRule() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('name', sLocales())\n    .required()\n    .prop('description', sLocales())\n    .prop('trigger', sCampaignRuleTrigger())\n    .required()\n    .prop('deposit', sCampaignRuleDeposit())\n    .required()\n    .prop('reward', sCampaignReward())\n    .required()\n    .prop('frequency', sCampaignRuleFrequency())\n    .required()\n}\n\nexport type CampaignRuleTrigger = 'DEPOSIT' | 'DEPOSIT_REQUEST' | 'MINT'\n\nexport function sCampaignRuleTrigger() {\n  return S.string().enum(['DEPOSIT', 'DEPOSIT_REQUEST', 'MINT'])\n}\n\nexport interface CampaignRuleDeposit {\n  type: CampaignRuleDepositType\n  value: number\n}\n\nexport function sCampaignRuleDeposit() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('type', sCampaignRuleDepositType())\n    .required()\n    .prop('value', S.number())\n    .required()\n}\n\nexport type CampaignRuleDepositType = 'BALANCE' | 'AGE'\n\nexport function sCampaignRuleDepositType() {\n  return S.string().enum(['BALANCE', 'AGE'])\n}\n\nexport interface CampaignReward {\n  type: CampaignRewardType\n  value: number\n}\n\nexport function sCampaignReward() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('type', sCampaignRewardType())\n    .required()\n    .prop('value', S.number())\n    .required()\n}\n\nexport type CampaignRewardType = 'AMOUNT' | 'MULTIPLIER' | 'PERCENTAGE'\n\nexport function sCampaignRewardType() {\n  return S.string().enum(['AMOUNT', 'MULTIPLIER', 'PERCENTAGE'])\n}\n\nexport interface CampaignRuleFrequency {\n  value: number\n  unit: UnitTime\n}\n\nexport function sCampaignRuleFrequency() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('value', S.number())\n    .required()\n    .prop('unit', sUnitTime())\n    .required()\n}\n\nexport interface CampaignBoost {\n  // Boost info\n  code: string\n  name: Locales\n  description?: Locales\n  operatorId?: string\n  link?: string\n\n  // Boost type and reward\n  type: CampaignBoostType\n  reward: CampaignReward\n}\n\nexport function sCampaignBoost() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', S.string())\n    .required()\n    .prop('name', sLocales())\n    .required()\n    .prop('description', sLocales())\n    .prop('operatorId', sStringId())\n    .prop('link', S.string())\n    .prop('type', sCampaignBoostType())\n    .required()\n    .prop('reward', sCampaignReward())\n    .required()\n}\n\nexport type CampaignBoostType = 'REFERRAL' | 'STAKE'\n\nexport function sCampaignBoostType() {\n  return S.string().enum(['REFERRAL', 'STAKE'])\n}\n\nexport interface CampaignReferral {\n  code: string\n  isActive: boolean\n}\n\nexport function sCampaignReferral() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', sCampaignReferralCode())\n    .required()\n    .prop('isActive', S.boolean())\n    .required()\n}\n\nexport function sCampaignReferralCode() {\n  return S.string().minLength(6).maxLength(8).pattern('^[a-zA-Z0-9]*$')\n}\n\nexport interface CampaignsSearchQuery extends PageSearchQuery {\n  code?: string | string[]\n  startDate?: string\n  'startDate:lt'?: string\n  'startDate:lte'?: string\n  'startDate:gt'?: string\n  'startDate:gte'?: string\n  endDate?: string\n  'endDate:lt'?: string\n  'endDate:lte'?: string\n  'endDate:gt'?: string\n  'endDate:gte'?: string\n}\n\nexport function sCampaignsSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', S.array().maxItems(200).items(S.string()))\n    .prop('tokenId', S.array().maxItems(200).items(sStringId()))\n    .description('The token IDentifier')\n    .prop('startDate', sDateString())\n    .description('The epoch start date equal than')\n    .prop('startDate:lt', sDateString())\n    .description('The epoch start date less than')\n    .prop('startDate:lte', sDateString())\n    .description('The epoch start date less or equal than')\n    .prop('startDate:gt', sDateString())\n    .description('The epoch start date greater than')\n    .prop('startDate:gte', sDateString())\n    .description('The epoch start date greater or equal than')\n    .prop('endDate', sDateString())\n    .description('The epoch end date equal than')\n    .prop('endDate:lt', sDateString())\n    .description('The epoch start date equal than')\n    .prop('endDate:lte', sDateString())\n    .description('The epoch start date equal than')\n    .prop('endDate:gt', sDateString())\n    .description('The epoch start date equal than')\n    .prop('endDate:gte', sDateString())\n    .description('The epoch start date equal than')\n    .extend(sPageSearchQuery(CAMPAIGN_FIELDS, CAMPAIGN_SORT_FIELDS))\n}\n\nexport interface CampaignsClientModel {\n  create: (body: CampaignData) => Promise<Campaign>\n  search: (params?: CampaignsSearchQuery) => Promise<Page<Campaign>>\n  searchAll: (params?: CampaignsSearchQuery) => Promise<Page<Campaign>>\n  list: (params?: CampaignsSearchQuery) => Promise<Campaign[]>\n  listAll: (params?: CampaignsSearchQuery) => Promise<Campaign[]>\n  findOne: (params?: CampaignsSearchQuery) => Promise<Campaign | undefined>\n}\n\nexport enum CampaignRoutes {\n  v1Create = `v1/${CAMPAIGNS_ROUTES_KEY}`,\n  v1Delete = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId`,\n  v1Read = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId`,\n  v1Update = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId`,\n  v1Search = `v1/${CAMPAIGNS_ROUTES_KEY}`,\n  v1Points = `v1/${CAMPAIGNS_ROUTES_KEY}/:campaignId/points`,\n}\n\nexport enum CampaignErrorCodes {\n  notFound = 'CAMPAIGN_NOT_FOUND',\n  notDeletable = 'CAMPAIGN_NOT_DELETABLE',\n  walletRequired = 'WALLET_REQUIRED',\n  referralNotValid = 'REFERRAL_CODE_INVALID',\n  referralCodeNotActive = 'REFERRAL_CODE_NOT_ACTIVE',\n}\n\nexport interface CampaignPointsQuery {\n  walletId?: string\n  walletAddress?: string\n}\n\nexport function sCampaignPointsQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletId', sStringId())\n    .description('Wallet Identifier')\n    .prop('walletAddress', sBCAddress())\n    .description('Wallet address')\n}\n\nexport interface CampaignPoints extends CampaignMetrics {\n  vaults?: CampaignPointsVault[]\n  boosts?: CampaignPointsBoost[]\n  metrics?: { [key: string]: string | number }\n}\n\nexport function sCampaignPoints() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('vaults', S.array().items(sCampaignPointsVault()))\n    .prop('boosts', S.array().items(sCampaignPointsBoost()))\n    .prop('metrics', sCampaignPointsMetrics())\n    .extend(sCampaignMetrics())\n}\n\nexport interface CampaignPointsVault extends CampaignMetrics {\n  _id: string\n}\n\nexport function sCampaignPointsVault() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('_id', sStringId())\n    .required()\n    .extend(sCampaignMetrics())\n}\n\nexport function sCampaignPointsMetrics() {\n  return S.object().additionalProperties(true)\n}\n\nexport interface CampaignMetrics {\n  points: string\n  perDay: string\n  multiplier: string\n}\n\nexport function sCampaignMetrics() {\n  return S.object()\n    .prop('points', S.string())\n    .required()\n    .prop('perDay', S.string())\n    .required()\n    .prop('multiplier', S.string())\n    .required()\n}\n\nexport interface CampaignPointsBoost extends CampaignMetrics {\n  code: string\n}\n\nexport function sCampaignPointsBoost() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', S.string())\n    .required()\n    .extend(sCampaignMetrics())\n}\n"],"names":["S","sClientEntity","sDateString","sLocales","sStringId","sUnitTime","sPageSearchQuery","sBCAddress","CAMPAIGN_FIELDS","CAMPAIGN_SORT_FIELDS","CAMPAIGNS_ROUTES_KEY","sCampaign","isPartial","object","id","additionalProperties","extend","sCampaignData","prop","string","array","items","sCampaignRule","sCampaignReferral","sCampaignBoost","number","required","sCampaignRuleTrigger","sCampaignRuleDeposit","sCampaignReward","sCampaignRuleFrequency","enum","sCampaignRuleDepositType","sCampaignRewardType","sCampaignBoostType","sCampaignReferralCode","boolean","minLength","maxLength","pattern","sCampaignsSearchQuery","maxItems","description","CampaignRoutes","CampaignErrorCodes","sCampaignPointsQuery","sCampaignPoints","sCampaignPointsVault","sCampaignPointsBoost","sCampaignPointsMetrics","sCampaignMetrics"],"mappings":"AAAA,OAAOA,OAAO,qBAAoB;AAClC,SAGEC,aAAa,EACbC,WAAW,EACXC,QAAQ,EACRC,SAAS,EAETC,SAAS,EAGTC,gBAAgB,EAChBC,UAAU,QACL,UAAS;AAChB,SACEC,eAAe,EACfC,oBAAoB,EACpBC,oBAAoB,QACf,mBAAkB;AAOzB,OAAO,SAASC,UAAUC,SAAmB;IAC3C,OAAOZ,EAAEa,MAAM,GACZC,EAAE,CAAC,aACHC,oBAAoB,CAAC,OACrBC,MAAM,CAACf,cAAcW,YACrBI,MAAM,CAACC,cAAcL;AAC1B;AAeA,OAAO,SAASK,cAAcL,SAAmB;IAC/C,OAAOZ,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQlB,EAAEmB,MAAM,IACrBD,IAAI,CAAC,QAAQf,YACbe,IAAI,CAAC,eAAef,YACpBe,IAAI,CAAC,SAASlB,EAAEoB,KAAK,GAAGC,KAAK,CAACC,kBAC9BJ,IAAI,CAAC,aAAalB,EAAEoB,KAAK,GAAGC,KAAK,CAACE,sBAClCL,IAAI,CAAC,UAAUlB,EAAEoB,KAAK,GAAGC,KAAK,CAACG,mBAC/BN,IAAI,CAAC,aAAahB,eAClBgB,IAAI,CAAC,WAAWhB,eAChBgB,IAAI,CAAC,QAAQlB,EAAEmB,MAAM,IACrBD,IAAI,CAAC,WAAWlB,EAAEyB,MAAM,IACxBC,QAAQ,CAACd,YAAY,EAAE,GAAG;QAAC;QAAQ;KAAO;AAC/C;AAoBA,OAAO,SAASU;IACd,OAAOtB,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQf,YACbuB,QAAQ,GACRR,IAAI,CAAC,eAAef,YACpBe,IAAI,CAAC,WAAWS,wBAChBD,QAAQ,GACRR,IAAI,CAAC,WAAWU,wBAChBF,QAAQ,GACRR,IAAI,CAAC,UAAUW,mBACfH,QAAQ,GACRR,IAAI,CAAC,aAAaY,0BAClBJ,QAAQ;AACb;AAIA,OAAO,SAASC;IACd,OAAO3B,EAAEmB,MAAM,GAAGY,IAAI,CAAC;QAAC;QAAW;QAAmB;KAAO;AAC/D;AAOA,OAAO,SAASH;IACd,OAAO5B,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQc,4BACbN,QAAQ,GACRR,IAAI,CAAC,SAASlB,EAAEyB,MAAM,IACtBC,QAAQ;AACb;AAIA,OAAO,SAASM;IACd,OAAOhC,EAAEmB,MAAM,GAAGY,IAAI,CAAC;QAAC;QAAW;KAAM;AAC3C;AAOA,OAAO,SAASF;IACd,OAAO7B,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQe,uBACbP,QAAQ,GACRR,IAAI,CAAC,SAASlB,EAAEyB,MAAM,IACtBC,QAAQ;AACb;AAIA,OAAO,SAASO;IACd,OAAOjC,EAAEmB,MAAM,GAAGY,IAAI,CAAC;QAAC;QAAU;QAAc;KAAa;AAC/D;AAOA,OAAO,SAASD;IACd,OAAO9B,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,SAASlB,EAAEyB,MAAM,IACtBC,QAAQ,GACRR,IAAI,CAAC,QAAQb,aACbqB,QAAQ;AACb;AAeA,OAAO,SAASF;IACd,OAAOxB,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQlB,EAAEmB,MAAM,IACrBO,QAAQ,GACRR,IAAI,CAAC,QAAQf,YACbuB,QAAQ,GACRR,IAAI,CAAC,eAAef,YACpBe,IAAI,CAAC,cAAcd,aACnBc,IAAI,CAAC,QAAQlB,EAAEmB,MAAM,IACrBD,IAAI,CAAC,QAAQgB,sBACbR,QAAQ,GACRR,IAAI,CAAC,UAAUW,mBACfH,QAAQ;AACb;AAIA,OAAO,SAASQ;IACd,OAAOlC,EAAEmB,MAAM,GAAGY,IAAI,CAAC;QAAC;QAAY;KAAQ;AAC9C;AAOA,OAAO,SAASR;IACd,OAAOvB,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQiB,yBACbT,QAAQ,GACRR,IAAI,CAAC,YAAYlB,EAAEoC,OAAO,IAC1BV,QAAQ;AACb;AAEA,OAAO,SAASS;IACd,OAAOnC,EAAEmB,MAAM,GAAGkB,SAAS,CAAC,GAAGC,SAAS,CAAC,GAAGC,OAAO,CAAC;AACtD;AAgBA,OAAO,SAASC;IACd,OAAOxC,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQlB,EAAEoB,KAAK,GAAGqB,QAAQ,CAAC,KAAKpB,KAAK,CAACrB,EAAEmB,MAAM,KACnDD,IAAI,CAAC,WAAWlB,EAAEoB,KAAK,GAAGqB,QAAQ,CAAC,KAAKpB,KAAK,CAACjB,cAC9CsC,WAAW,CAAC,wBACZxB,IAAI,CAAC,aAAahB,eAClBwC,WAAW,CAAC,mCACZxB,IAAI,CAAC,gBAAgBhB,eACrBwC,WAAW,CAAC,kCACZxB,IAAI,CAAC,iBAAiBhB,eACtBwC,WAAW,CAAC,2CACZxB,IAAI,CAAC,gBAAgBhB,eACrBwC,WAAW,CAAC,qCACZxB,IAAI,CAAC,iBAAiBhB,eACtBwC,WAAW,CAAC,8CACZxB,IAAI,CAAC,WAAWhB,eAChBwC,WAAW,CAAC,iCACZxB,IAAI,CAAC,cAAchB,eACnBwC,WAAW,CAAC,mCACZxB,IAAI,CAAC,eAAehB,eACpBwC,WAAW,CAAC,mCACZxB,IAAI,CAAC,cAAchB,eACnBwC,WAAW,CAAC,mCACZxB,IAAI,CAAC,eAAehB,eACpBwC,WAAW,CAAC,mCACZ1B,MAAM,CAACV,iBAAiBE,iBAAiBC;AAC9C;;UAWYkC;gDACC,CAAC,GAAG,EAAEjC,qBAAqB,CAAC;gDAC5B,CAAC,GAAG,EAAEA,qBAAqB,YAAY,CAAC;8CAC1C,CAAC,GAAG,EAAEA,qBAAqB,YAAY,CAAC;gDACtC,CAAC,GAAG,EAAEA,qBAAqB,YAAY,CAAC;gDACxC,CAAC,GAAG,EAAEA,qBAAqB,CAAC;gDAC5B,CAAC,GAAG,EAAEA,qBAAqB,mBAAmB,CAAC;GANhDiC,mBAAAA;;UASAC;;;;;;GAAAA,uBAAAA;AAaZ,OAAO,SAASC;IACd,OAAO7C,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,YAAYd,aACjBsC,WAAW,CAAC,qBACZxB,IAAI,CAAC,iBAAiBX,cACtBmC,WAAW,CAAC;AACjB;AAQA,OAAO,SAASI;IACd,OAAO9C,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,UAAUlB,EAAEoB,KAAK,GAAGC,KAAK,CAAC0B,yBAC/B7B,IAAI,CAAC,UAAUlB,EAAEoB,KAAK,GAAGC,KAAK,CAAC2B,yBAC/B9B,IAAI,CAAC,WAAW+B,0BAChBjC,MAAM,CAACkC;AACZ;AAMA,OAAO,SAASH;IACd,OAAO/C,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,OAAOd,aACZsB,QAAQ,GACRV,MAAM,CAACkC;AACZ;AAEA,OAAO,SAASD;IACd,OAAOjD,EAAEa,MAAM,GAAGE,oBAAoB,CAAC;AACzC;AAQA,OAAO,SAASmC;IACd,OAAOlD,EAAEa,MAAM,GACZK,IAAI,CAAC,UAAUlB,EAAEmB,MAAM,IACvBO,QAAQ,GACRR,IAAI,CAAC,UAAUlB,EAAEmB,MAAM,IACvBO,QAAQ,GACRR,IAAI,CAAC,cAAclB,EAAEmB,MAAM,IAC3BO,QAAQ;AACb;AAMA,OAAO,SAASsB;IACd,OAAOhD,EAAEa,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQlB,EAAEmB,MAAM,IACrBO,QAAQ,GACRV,MAAM,CAACkC;AACZ"}