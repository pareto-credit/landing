{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/wallet-blocks/wallet-block.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport { ClientEntity, Block, iBigInt, PageSearchQuery, Page } from '../core'\nimport {\n  sBCAddress,\n  sBigInt,\n  sBlock,\n  sClientEntity,\n  sPageSearchQuery,\n  sStringId,\n} from '../core'\nimport { WALLET_BLOCKS_ROUTES_KEY } from './wallet-block.const'\nimport {\n  sVaultWalletCdoEpochData,\n  sVaultWalletParetoDollarData,\n  sVaultWalletPoolData,\n  VaultWalletCdoEpochData,\n  VaultWalletParetoDollarData,\n  VaultWalletPoolData,\n} from '../vaults'\n\n/**\n * Client Vault interface\n */\nexport interface WalletBlock extends WalletBlockData, ClientEntity {}\n\nexport function sWalletBlock(isPartial?: boolean) {\n  return S.object()\n    .id('#walletBlock')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sWalletBlockData(isPartial))\n}\n\nexport interface WalletBlockData extends WalletBlockBody {\n  walletId: string\n  walletAddress: string\n  vaultId: string\n  vaultAddress: string\n  block: Block\n}\n\nexport function sWalletBlockData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletId', sStringId())\n    .description('The IDentifier of the wallet.')\n    .prop('walletAddress', sBCAddress())\n    .description('The blockchain address of the wallet.')\n    .prop('vaultId', sStringId())\n    .description('The IDentifier of the vault.')\n    .prop('vaultAddress', sBCAddress())\n    .description('The blockchain address vault.')\n    .prop('block', sBlock())\n    .description('The block number.')\n    .required(\n      isPartial\n        ? []\n        : ['walletId', 'walletAddress', 'vaultId', 'vaultAddress', 'block']\n    )\n    .extend(sWalletBlockBody(isPartial))\n}\n\n/**\n * The updateable data of the block\n */\nexport interface WalletBlockBody {\n  // Balance of vault token\n  balance: iBigInt\n  // Balance of underlying token\n  tokenBalance: iBigInt\n  // Distributed rewards\n  distributedRewards?: WalletBlockDistributedRewards[]\n  cdoEpoch?: VaultWalletCdoEpochData\n  paretoDollar?: VaultWalletParetoDollarData\n  pools?: VaultWalletPoolData[]\n}\n\nexport function sWalletBlockBody(isPartial?: boolean) {\n  return (\n    S.object()\n      .additionalProperties(false)\n      .prop('balance', sBigInt())\n      .description('The balance of the wallet in the vault.')\n      .prop('tokenBalance', sBigInt())\n      .description('The current token balance of the wallet.')\n      .prop(\n        'distributedRewards',\n        S.array().items(sWalletBlockDistributedRewards())\n      )\n      .description('List of distributed rewards for the wallet')\n      .prop('cdoEpoch', sVaultWalletCdoEpochData())\n      .prop('paretoDollar', sVaultWalletParetoDollarData())\n      .prop('pools', S.array().items(sVaultWalletPoolData()))\n      // Deprecated\n      .prop('current', S.object().additionalProperties(true))\n      .prop('uspAggregated', S.object().additionalProperties(true))\n      .required(isPartial ? [] : ['balance', 'tokenBalance'])\n  )\n}\n\nexport interface WalletBlockDistributedRewards {\n  tokenId: string\n  tokenAddress: string\n  amount: string\n  amountUSD: string\n}\n\nexport function sWalletBlockDistributedRewards() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('tokenId', sStringId())\n    .required()\n    .prop('tokenAddress', sBCAddress())\n    .required()\n    .prop('amount', S.string())\n    .required()\n    .prop('amountUSD', S.string())\n    .required()\n}\n\nexport enum WalletBlockErrorCodes {\n  alreadyExists = 'WALLET_BLOCK_ALREADY_EXISTS',\n}\n\nexport interface WalletBlocksClientModel {\n  findOne: (\n    params?: WalletBlocksSearchQuery\n  ) => Promise<WalletBlock | undefined>\n  search: (params?: WalletBlocksSearchQuery) => Promise<Page<WalletBlock>>\n  searchAll: (params?: WalletBlocksSearchQuery) => Promise<Page<WalletBlock>>\n  list: (params?: WalletBlocksSearchQuery) => Promise<WalletBlock[]>\n  listAll: (params?: WalletBlocksSearchQuery) => Promise<WalletBlock[]>\n}\n\nexport enum WalletBlockRoutes {\n  v1Create = `v1/${WALLET_BLOCKS_ROUTES_KEY}`,\n  v1Delete = `v1/${WALLET_BLOCKS_ROUTES_KEY}/:walletBlockId`,\n  v1Read = `v1/${WALLET_BLOCKS_ROUTES_KEY}/:walletBlockId`,\n  v1Update = `v1/${WALLET_BLOCKS_ROUTES_KEY}/:walletBlockId`,\n  v1Search = `v1/${WALLET_BLOCKS_ROUTES_KEY}`,\n}\n\nexport type WalletBlockFields =\n  | '_id'\n  | 'walletId'\n  | 'walletAddress'\n  | 'vaultId'\n  | 'vaultAddress'\n  | 'block'\n  | 'balance'\n  | 'tokenBalance'\n\nexport const WALLET_BLOCK_FIELDS = [\n  '_id',\n  'walletId',\n  'walletAddress',\n  'vaultId',\n  'vaultAddress',\n  'block',\n  'balance',\n  'tokenBalance',\n]\n\nexport const WALLET_BLOCK_SORT_FIELDS = ['balance', 'tokenBalance', 'timestamp']\n\nexport type WalletBlocksSideData = 'wallet' | 'user' | 'performance'\n\nexport interface WalletBlocksSearchQuery\n  extends PageSearchQuery<\n    'balance' | 'tokenBalance' | 'timestamp',\n    WalletBlockFields\n  > {\n  walletId?: string | string[]\n  walletAddress?: string | string[]\n  vaultId?: string | string[]\n  vaultAddress?: string | string[]\n  'balance:gt'?: number | string\n  'tokenBalance:gt'?: number | string\n  'timestamp:gte'?: number\n  'timestamp:lte'?: number\n}\n\nexport function sWalletBlocksSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletId', S.array().minItems(1).maxItems(200).items(sStringId()))\n    .description('The wallet IDentifier')\n    .prop(\n      'walletAddress',\n      S.array().minItems(1).maxItems(200).items(sBCAddress())\n    )\n    .description('The wallet blockchain address')\n    .prop('vaultId', S.array().minItems(1).maxItems(200).items(sStringId()))\n    .description('The vault IDentifier')\n    .prop(\n      'vaultAddress',\n      S.array().minItems(1).maxItems(200).items(sBCAddress())\n    )\n    .description('The vault blockchain address')\n    .prop('balance:gt', S.string())\n    .description('The wallet minimum balance')\n    .prop('tokenBalance:gt', S.string())\n    .description('The wallet minimum token balance')\n    .prop('timestamp:gte', S.number())\n    .description('Start timestamp of the wallet block.')\n    .prop('timestamp:lte', S.number())\n    .description('End timestamp of the wallet block.')\n    .extend(sPageSearchQuery(WALLET_BLOCK_FIELDS, WALLET_BLOCK_SORT_FIELDS))\n}\n"],"names":["WALLET_BLOCK_FIELDS","WALLET_BLOCK_SORT_FIELDS","sWalletBlock","sWalletBlockBody","sWalletBlockData","sWalletBlockDistributedRewards","sWalletBlocksSearchQuery","isPartial","S","object","id","additionalProperties","extend","sClientEntity","prop","sStringId","description","sBCAddress","sBlock","required","sBigInt","array","items","sVaultWalletCdoEpochData","sVaultWalletParetoDollarData","sVaultWalletPoolData","string","WalletBlockErrorCodes","WalletBlockRoutes","WALLET_BLOCKS_ROUTES_KEY","minItems","maxItems","number","sPageSearchQuery"],"mappings":"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"}