{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/core/utility.lib.ts"],"sourcesContent":["import { Locales, Period, UnitTime } from './utility.model'\nimport moment from 'moment'\nimport Ajv, { ErrorObject } from 'ajv'\nimport { difference, get, pickBy, uniq } from 'lodash'\nimport { BigNumberValue, BNify } from './bigint.lib'\nimport BigNumber from 'bignumber.js'\nimport crypto from 'crypto'\n\n/**\n * Escape Regular Expression for security reason\n * @param value - the string to excape\n * @returns the string excaped\n */\nexport function escapeRegExp(value: string) {\n  return value.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&') // $& means the whole matched string\n}\n\n/**\n * Stringify object with bigint check\n * @param s - the object to stringify\n * @returns the string of the object\n */\nexport function stringify(s: any): string {\n  return JSON.stringify(s, (_, v) => (typeof v === 'bigint' ? v.toString() : v))\n}\n\n/**\n * Convert value to number if defined\n * @param value the value to convert\n * @returns the number value or undefined\n */\nexport function toNumber(value?: number | string) {\n  return value === undefined ? undefined : Number(value)\n}\n\n/**\n * Convert value to string if defined\n * @param value the value to convert\n * @returns the string value or undefined\n */\nexport function toString(value?: number | string) {\n  return value === undefined ? undefined : String(value)\n}\n/**\n * Compare two string\n * @param s1 - the string one\n * @param s2 - the string two\n * @returns true if equal\n */\nexport function compLower(s1: string, s2: string): boolean {\n  return s1.toLowerCase() === s2.toLowerCase()\n}\n\n/**\n * Validate object against schema\n * @param schema schema.valueOf()\n * @param object object to validate\n * @returns object schema validation\n */\nexport function validateSchema(\n  schema: any,\n  object: any\n): {\n  valid: boolean\n  errors?: null | ErrorObject[]\n} {\n  try {\n    const ajv = new Ajv({ strict: false })\n    const validate = ajv.compile(schema)\n    const valid = validate(object)\n    return {\n      valid,\n      errors: validate.errors,\n    }\n  } catch (err) {\n    return {\n      valid: false,\n      errors: [err as ErrorObject],\n    }\n  }\n}\n\n/**\n * Replace many assertion\n * @param str - the string\n * @param replacements - the replacements to use\n * @returns the new string\n */\nexport function replaceMany(\n  str: string,\n  replacements: Record<string, string>\n): string {\n  return Object.entries(replacements).reduce((acc: string, [key, value]) => {\n    return acc.replace(key, value)\n  }, str)\n}\n\n/**\n * Format a number using Internationalization API\n * @param amount - the amount\n * @param lang - the lang code\n * @param currency - the currency to use\n * @returns the number formatted\n */\nexport function numberFormat(\n  amount: number | bigint,\n  options?: Intl.NumberFormatOptions,\n  lang: 'en-US' = 'en-US'\n): string {\n  const formatter = new Intl.NumberFormat(lang, options)\n  return formatter.format(amount)\n}\n\n/**\n * Format seconds in a human readable unit time\n * @param seconds the seconds amount\n * @returns the period data\n */\nexport function secondsToPeriod(seconds: number): Period {\n  const duration = seconds || 0\n  const unit: UnitTime =\n    duration < 120\n      ? 'seconds'\n      : duration < 3600\n      ? 'minutes'\n      : duration < 86400\n      ? 'hours'\n      : 'days'\n\n  return {\n    duration: +moment\n      .duration(seconds || 0, 'seconds')\n      .as(unit)\n      .toFixed(2),\n    unit,\n  }\n}\n\n/**\n * Format a period to seconds\n * @param duration - the duration\n * @param unit - the unit time\n * @returns the amount of seconds\n */\nexport function periodToSeconds(duration: number, unit: UnitTime): number {\n  return Math.floor(moment.duration(duration, unit).asSeconds())\n}\n\n/**\n * Split an amount of seconds into multiple periods\n * @param seconds the seconds amount\n * @returns the periods\n */\nexport function secondsToPeriods(seconds: any) {\n  const units = [\n    { label: 'year', seconds: 31536000 },\n    { label: 'day', seconds: 86400 },\n    { label: 'hour', seconds: 3600 },\n    { label: 'minute', seconds: 60 },\n    { label: 'second', seconds: 1 },\n  ]\n\n  let timeString = ''\n\n  for (const unit of units) {\n    const unitValue = Math.floor(seconds / unit.seconds)\n    if (unitValue > 0) {\n      timeString += `${unitValue} ${unit.label}${unitValue > 1 ? 's' : ''} `\n      seconds %= unit.seconds\n    }\n  }\n\n  return timeString.trim()\n}\n\n/**\n * Capitalize the first letter of a string\n * @param string - the string to modify\n * @returns the string capitalized\n */\nexport function capitalize(string: string) {\n  return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase()\n}\n\n/**\n * Format a string \"Hello %{friend}\" and params { 'friend': 'John' }\n * into a parsed string \"Hello John\"\n * @param template - the template string\n * @param params - the params\n * @returns the string formatted\n */\nexport function formatString(\n  template: string,\n  params: { [key: string]: string | number } = {}\n): string {\n  return template.includes('%{')\n    ? template.replace(/%\\{(.*?)\\}/g, (match, key) => {\n        return params[key] !== undefined ? String(params[key]) : match\n      })\n    : template\n}\n\n/**\n * Remove all falsy values from an object\n * @param obj - the object to clean\n * @return the object cleaned\n */\nexport function cleanObject<T extends object>(obj: T): Partial<T> {\n  return pickBy(obj, (value) => {\n    if (value === null || value === undefined || value === '') return false\n    if (Array.isArray(value) && value.length === 0) return false\n    if (typeof value === 'object' && Object.keys(value).length === 0)\n      return false\n    return true\n  })\n}\n\n/**\n * Make the difference between two arrays and returns\n * @param first - the first array data\n * @param second - the second array data\n * @returns the difference values between two arrays\n */\nexport function arrayDiff<T = string, K = string, R = string>(\n  first: { items: T[]; key?: keyof T },\n  second: { items: K[]; key?: keyof K }\n) {\n  return difference<R>(\n    uniq(\n      first.items\n        .map((item) => (first.key ? item[first.key] : item))\n        .filter((value) => value !== undefined)\n    ) as R[],\n    uniq(\n      second.items\n        .map((sec) => (second.key ? sec[second.key] : sec))\n        .filter((value) => value !== undefined)\n    ) as R[]\n  )\n}\n\n/**\n * Compound APR and return APY\n * @param apr APR\n * @param period compounding period\n * @returns Compounded APR\n */\nexport function apr2apy(apr: BigNumberValue, period = 365): BigNumber {\n  return BNify(\n    BNify(1).plus(BNify(apr).div(period)).pow(period).minus(1).toFixed(18)\n  )\n}\n\n/**\n *  * Return an array of items (useful for route filters)\n * @param item item\n * @returns array of items\n */\nexport function arrayFy<T = any>(item: T | T[]) {\n  return Array.isArray(item) ? item : item ? [item] : []\n}\n\n/**\n * Check if a string is a code\n * @paramc code - the code string to verify\n * @returns true if is a code\n */\nexport function isCode(\n  code: string,\n  minLength: number,\n  maxLength: number\n): boolean {\n  const regex = new RegExp(`^[a-zA-Z0-9]{${minLength},${maxLength}}$`)\n  return !!code.match(regex)\n}\n\n/**\n * Generate a unique 6-character uppercase hexadecimal code from a wallet address\n * @param address - the wallet address\n * @param length - the length of the code\n * @returns a 6-character uppercase hexadecimal code\n */\nexport function generateHexCode(address: string, length = 6): string {\n  const hash = crypto.createHash('sha256').update(address).digest('hex')\n  return hash.slice(0, length).toUpperCase()\n}\n\n/**\n * Transform an array into a dictionary\n * @param array - the array of objects\n * @param key - the key to use as dictionary key\n * @returns the dictionary object\n */\nexport function arrayToDict<T extends object, K extends keyof T>(\n  array: T[],\n  key: K,\n  keyValue?: K\n): Record<string, any> {\n  return array.reduce((acc, item) => {\n    const k = String(item[key])\n    const value = keyValue ? get(item, keyValue) : item\n    return { ...acc, [k]: value }\n  }, {})\n}\n\n/**\n * Parse percentage value\n * @param value - the value to parse\n * @param decimals - the maximum decimals\n * @returns the value parsed\n */\nexport function parsePercentage(value: string | number, decimals = 2) {\n  return numberFormat(Number(value) / 100, {\n    style: 'percent',\n    maximumFractionDigits: decimals,\n  })\n}\n\n/**\n * Get locale string\n * @param locales - the locales object\n * @param defaultLabel - the placeholder string\n */\nexport function getLocale(\n  locales?: Locales,\n  language = 'en',\n  defaultLabel?: string\n): string | undefined {\n  return locales ? locales[language] : defaultLabel\n}\n"],"names":["apr2apy","arrayDiff","arrayFy","arrayToDict","capitalize","cleanObject","compLower","escapeRegExp","formatString","generateHexCode","getLocale","isCode","numberFormat","parsePercentage","periodToSeconds","replaceMany","secondsToPeriod","secondsToPeriods","stringify","toNumber","toString","validateSchema","value","replace","s","JSON","_","v","undefined","Number","String","s1","s2","toLowerCase","schema","object","ajv","Ajv","strict","validate","compile","valid","errors","err","str","replacements","Object","entries","reduce","acc","key","amount","options","lang","formatter","Intl","NumberFormat","format","seconds","duration","unit","moment","as","toFixed","Math","floor","asSeconds","units","label","timeString","unitValue","trim","string","charAt","toUpperCase","slice","template","params","includes","match","obj","pickBy","Array","isArray","length","keys","first","second","difference","uniq","items","map","item","filter","sec","apr","period","BNify","plus","div","pow","minus","code","minLength","maxLength","regex","RegExp","address","hash","crypto","createHash","update","digest","array","keyValue","k","get","decimals","style","maximumFractionDigits","locales","language","defaultLabel"],"mappings":"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"}