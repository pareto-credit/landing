{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/ethers/ethers.lib.ts"],"sourcesContent":["import { Transaction, utils, Event, BigNumberish, BigNumber } from 'ethers'\nimport { EthersEvent } from './ethers.model'\nimport { decodeAbiParameters } from '../core'\n\n/**\n * Get Ethers topic\n * @returns the event topic\n */\nexport function getEthersTopicTransfer() {\n  return utils.id('Transfer(address,address,uint256)')\n}\n\n/**\n * Parse ethers event\n * @param event - the contract event\n * @returns the ethers event object\n */\nexport function parseEthersEvent(event: Event): EthersEvent {\n  return {\n    address: event['address'],\n    topics: event['topics'],\n    data: event['data'],\n    blockHash: event['blockHash'],\n    blockNumber: event['blockNumber'],\n    transactionHash: event['transactionHash'],\n    transactionIndex: event['transactionIndex'],\n    event: event['event'],\n    eventSignature: event['eventSignature'],\n    values: normalizeEthersArgs(event['args']),\n  }\n}\n\n/**\n * Get transaction method signature\n * @param transaction - the ethers transaction\n * @returns the method signature of a\n */\nexport function getEthersTransactionSignature(\n  transaction: Transaction\n): string {\n  const transactionData = getEthersTransactionInputData(transaction)\n  return transactionData ? transactionData.slice(0, 10) : ''\n}\n\n/**\n * Decode SAFE transaction input and get data\n * @param transaction web3 transaction\n * @returns SAFE transaction input hex string\n */\nexport function getEthersTransactionInputData(\n  transaction: Transaction\n): string | undefined {\n  const isSafe = transaction.data.slice(0, 10) === '0x6a761202'\n  if (!isSafe) {\n    return String(transaction.data)\n  }\n  const txData = transaction.data?.slice(10)\n  if (!txData) {\n    return\n  }\n  const inputParams = decodeAbiParameters(\n    [\n      'address',\n      'uint256',\n      'bytes',\n      'uint8',\n      'uint256',\n      'uint256',\n      'uint256',\n      'address',\n      'address',\n      'bytes',\n    ],\n    txData\n  )\n\n  return String(inputParams[2])\n}\n\n/**\n * Normalize args in record values\n * @param args - the event args\n * @returns the event values object\n */\nexport function normalizeEthersArgs(\n  args: Event['args'] = []\n): Record<string, any> {\n  const result: Record<string, any> = {}\n\n  for (const key in args) {\n    result[key] = parseEthersArg(args[key])\n  }\n\n  return result\n}\n\nfunction parseEthersArg(arg: BigNumberish) {\n  if (BigNumber.isBigNumber(arg)) {\n    return arg.toString()\n  }\n\n  return arg\n}\n"],"names":["getEthersTopicTransfer","getEthersTransactionInputData","getEthersTransactionSignature","normalizeEthersArgs","parseEthersEvent","utils","id","event","address","topics","data","blockHash","blockNumber","transactionHash","transactionIndex","eventSignature","values","transaction","transactionData","slice","isSafe","String","txData","inputParams","decodeAbiParameters","args","result","key","parseEthersArg","arg","BigNumber","isBigNumber","toString"],"mappings":";;;;;;;;;;;IAQgBA,sBAAsB;eAAtBA;;IAyCAC,6BAA6B;eAA7BA;;IAZAC,6BAA6B;eAA7BA;;IA+CAC,mBAAmB;eAAnBA;;IAnEAC,gBAAgB;eAAhBA;;;wBAjBmD;sBAE/B;AAM7B,SAASJ;IACd,OAAOK,aAAK,CAACC,EAAE,CAAC;AAClB;AAOO,SAASF,iBAAiBG,KAAY;IAC3C,OAAO;QACLC,SAASD,KAAK,CAAC,UAAU;QACzBE,QAAQF,KAAK,CAAC,SAAS;QACvBG,MAAMH,KAAK,CAAC,OAAO;QACnBI,WAAWJ,KAAK,CAAC,YAAY;QAC7BK,aAAaL,KAAK,CAAC,cAAc;QACjCM,iBAAiBN,KAAK,CAAC,kBAAkB;QACzCO,kBAAkBP,KAAK,CAAC,mBAAmB;QAC3CA,OAAOA,KAAK,CAAC,QAAQ;QACrBQ,gBAAgBR,KAAK,CAAC,iBAAiB;QACvCS,QAAQb,oBAAoBI,KAAK,CAAC,OAAO;IAC3C;AACF;AAOO,SAASL,8BACde,WAAwB;IAExB,MAAMC,kBAAkBjB,8BAA8BgB;IACtD,OAAOC,kBAAkBA,gBAAgBC,KAAK,CAAC,GAAG,MAAM;AAC1D;AAOO,SAASlB,8BACdgB,WAAwB;QAMTA;IAJf,MAAMG,SAASH,YAAYP,IAAI,CAACS,KAAK,CAAC,GAAG,QAAQ;IACjD,IAAI,CAACC,QAAQ;QACX,OAAOC,OAAOJ,YAAYP,IAAI;IAChC;IACA,MAAMY,UAASL,oBAAAA,YAAYP,IAAI,qBAAhBO,kBAAkBE,KAAK,CAAC;IACvC,IAAI,CAACG,QAAQ;QACX;IACF;IACA,MAAMC,cAAcC,IAAAA,yBAAmB,EACrC;QACE;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD,EACDF;IAGF,OAAOD,OAAOE,WAAW,CAAC,EAAE;AAC9B;AAOO,SAASpB,oBACdsB,OAAsB,EAAE;IAExB,MAAMC,SAA8B,CAAC;IAErC,IAAK,MAAMC,OAAOF,KAAM;QACtBC,MAAM,CAACC,IAAI,GAAGC,eAAeH,IAAI,CAACE,IAAI;IACxC;IAEA,OAAOD;AACT;AAEA,SAASE,eAAeC,GAAiB;IACvC,IAAIC,iBAAS,CAACC,WAAW,CAACF,MAAM;QAC9B,OAAOA,IAAIG,QAAQ;IACrB;IAEA,OAAOH;AACT"}