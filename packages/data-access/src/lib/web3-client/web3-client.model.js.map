{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/web3-client/web3-client.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport { ContractEventOptions, PayableMethodObject } from 'web3-eth-contract'\n\nimport { sAbiContract, sBCAddress, sBigInt, sStringId } from '../core'\nimport Web3, {\n  Block,\n  Contract,\n  ContractAbi,\n  EventLog,\n  Filter,\n  Transaction,\n  TransactionReceipt,\n} from 'web3'\nimport { Abi, AbiContract, BlockNumber, iBigInt } from '../core'\nimport { VaultContractType } from '../vaults'\nimport { TransactionType } from '../transactions'\n\nexport interface Web3ClientOptions {\n  web3: Web3\n  provider: Web3RPCProvider\n  contractAddress?: string\n  blocksPerYear?: number\n  logger?: any\n}\n\nexport interface ERC20Token {\n  decimals: number\n  symbol: string\n  name: string\n  address: string\n}\n\nexport function sERC20Token() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('decimals', S.number())\n    .required()\n    .prop('symbol', S.string())\n    .required()\n    .prop('name', S.string())\n    .required()\n    .prop('address', sBCAddress())\n    .required()\n}\n\nexport type Web3Clients = {\n  [chainId: string]: Web3ClientModel\n}\n\nexport interface Web3ClientModel {\n  web3: Web3\n  provider: Web3RPCProvider\n  blocksPerYear: number\n  initContract: (abi: ContractAbi, address: string) => Contract<Abi>\n  parseBlock: (blockNumber: BlockNumber) => string\n  createTopic: (topic: Web3Topic) => string\n  getTransaction: (hash: string) => Promise<Transaction | undefined>\n  getTransactionLogs: (hash: string) => Promise<TransactionReceipt['logs']>\n  getERC20: (address: string) => Promise<ERC20Token | undefined>\n  getContractEvents: (\n    contract: Contract<Abi>,\n    eventType: 'Transfer',\n    startBlock: BlockNumber,\n    endBlock?: BlockNumber,\n    filters?: Filter,\n    maxBlocks?: number\n  ) => Promise<Web3Event[]>\n  call: (\n    callData: Web3CallData[],\n    blockNumber?: BlockNumber\n  ) => Promise<Web3CallData[]>\n  getBlock: (blockNumber?: string | number | bigint) => Promise<Block>\n}\n\nexport type Web3Protocol =\n  | 'Idle'\n  | 'Clearpool'\n  | 'AaveV2'\n  | 'Gearbox'\n  | 'Compound'\n  | 'Lido'\n  | 'InstadApp'\n  | 'UniswapV2'\n  | 'UniswapV3'\n  | 'Morpho'\n  | 'Ethena'\n  | 'Curve'\n  | 'Sky'\n  | 'Balancer'\n  | 'BalancerGauge'\n  | 'NapierPT'\n  | 'NapierYT'\n  | 'NapierLP'\n  | 'PendlePT'\n  | 'PendleLP'\n  | 'PendleSY'\n  | 'PendleYT'\n  | 'Euler'\n  | 'EulerSupply'\n  | 'Penpie'\n  | 'TermFinance'\n\nexport function sWeb3Protocol() {\n  return S.string().enum([\n    'Idle',\n    'Clearpool',\n    'AaveV2',\n    'Morpho',\n    'Gearbox',\n    'Compound',\n    'Lido',\n    'InstadApp',\n    'Ethena',\n    'UniswapV2',\n    'UniswapV3',\n    'Curve',\n    'Sky',\n    'Balancer',\n    'BalancerGauge',\n    'NapierPT',\n    'NapierYT',\n    'NapierLP',\n    'PendlePT',\n    'PendleLP',\n    'PendleSY',\n    'PendleYT',\n    'Euler',\n    'EulerSupply',\n    'Penpie',\n    'TermFinance',\n  ])\n}\n\nexport type Web3ContractType =\n  | VaultContractType\n  | 'ERC20'\n  | 'POOL'\n  | 'TOKEN'\n  | 'ORACLE'\n  | 'TRANCHE'\n  | 'STRATEGY'\n  | 'WALLET'\n  | 'POOL_TOKEN'\n  | 'WALLET_POOL'\n  | 'CDO_EPOCH_STRATEGY'\n  | 'WALLET_DEPOSIT_QUEUE'\n  | 'WALLET_WITHDRAW_QUEUE'\n  | 'CDO_EPOCH_DEPOSIT_QUEUE'\n  | 'CDO_EPOCH_WITHDRAW_QUEUE'\n  | 'WALLET_CDO_EPOCH_STRATEGY'\n  | 'PARETO_DOLLAR_QUEUE'\n  | 'PARETO_DOLLAR_QUEUE_EPOCH_PENDING'\n  | 'PARETO_DOLLAR_STAKING'\n  | 'WALLET_PARETO_DOLLAR_STAKING'\n  | 'PARETO_DOLLAR_QUEUE_YIELD_SOURCE'\n  | 'WALLET_EULER_ACCOUNT_LENS'\n  | 'WALLET_CDO_EPOCH_WRITEOFF'\n\nexport interface Web3Provider {\n  web3: Web3\n  provider: Web3RPCProvider\n}\n\nexport interface Web3ProviderConnection {\n  provider: Web3RPCProvider\n  https?: string\n  wss?: string\n}\n\nexport function sWeb3ProviderConnection() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('provider', sWeb3RPCProvider())\n    .description('The RPC provider.')\n    .required()\n    .prop('https', S.string())\n    .description('The RPC official https URL.')\n    .prop('wss', S.string())\n    .description('The RPC official wss URL.')\n}\n\nexport type Web3RPCProvider = 'INFURA' | 'ALCHEMY' | 'PUBLIC'\n\nexport function sWeb3RPCProvider() {\n  return S.string().enum(['INFURA', 'ALCHEMY', 'PUBLIC'])\n}\n\nexport type Web3Event = EventLog & { values: EventLog['returnValues'] }\n\nexport interface Web3EventsOptions {\n  event: string\n  type: TransactionType\n  contract: Contract<Abi>\n  options: ContractEventOptions\n}\n\nexport interface Web3Tokens {\n  INFURA?: string\n  ALCHEMY?: string\n}\n\nexport interface Web3WalletTokens {\n  walletConnect?: string\n  onBoardKey?: string\n}\n\nexport type Web3Subscription =\n  | 'logs'\n  | 'newBlockHeaders'\n  | 'newHeads'\n  | 'newPendingTransactions'\n  | 'pendingTransactions'\n  | 'syncing'\n\nexport interface Web3SubscriptionOptions {\n  filter?: any\n  fromBlock?: number\n  topics?: Web3Topic[]\n}\n\nexport interface Web3PayableOptionsParams {\n  method: PayableMethodObject\n  from: string\n  toleranceBearing?: number\n  value?: string\n}\n\nexport type Web3Topic = 'transfer'\n\nexport interface Web3Entity {\n  protocol: Web3Protocol\n  type: Web3ContractType\n  address: string\n}\n\nexport interface Web3CallData extends Web3Entity {\n  block: 'current' | 'previous'\n  method: string\n  parent?: Web3Entity\n  params?: Web3ContractMethodParam[]\n  inputs: Web3DataParam[]\n  outputs: Web3DataParam[]\n}\n\nexport interface Web3DataParam {\n  name?: string\n  type: string\n  value?: any\n  components?: any\n}\n\nexport type Web3DataParamType =\n  | string\n  | {\n      type: string\n      components: any\n    }\n\nexport interface Web3DataParams {\n  names: Array<string | undefined>\n  types: Array<Web3DataParamType>\n  values: Array<any>\n}\n\nexport interface Web3CallParam {\n  address: string\n  allowFailure: 0 | 1\n  bytes: string\n}\n\nexport interface Web3TransactionFee {\n  ETH: string\n  USD?: string\n}\n\nexport interface Web3Contract {\n  web3Client: Web3ClientModel\n  contract: Contract<Abi>\n  address: string\n}\n\nexport interface Web3ContractMethod {\n  protocol: Web3Protocol\n  type: Web3ContractType\n  block: 'current' | 'previous'\n  method: string\n  params?: Web3ContractMethodParam[]\n  tokenSymbol?: string\n}\n\nexport type Web3ContractMethodParam =\n  | '0'\n  | '1'\n  | '1e18'\n  | 'vaultAddress'\n  | 'tokenAddress'\n  | 'walletAddress'\n  | 'spenderAddress'\n  | 'tokenAmount'\n  | 'tokenFee'\n  | 'epochNumber'\n  | 'prevEpochNumber'\n  | 'tokenPriceLimit'\n  | 'yieldSourceAddress'\n  | 'lpBalance'\n  | 'poolAddress'\n  | 'oracleAddress'\n  | 'tokenAddress[ARB]'\n  | 'tokenAddress[USDC]'\n  | 'tokenAddress[WETH]'\n  | 'tokenAddress[stETH]'\n  | 'tokenAddress[USDe]'\n  | 'tokenAddress[MATIC]'\n  | 'tokenAddress[OP]'\n  | 'tokenAddresses[USDC|OP]'\n  | 'tokenAddresses[USDC|WETH]'\n  | 'tokenAddresses[USDC|MATIC]'\n  | 'tokenAddresses[USDC|WETH|stETH]'\n\nexport interface Web3ProtocolContract extends Web3BaseContract {\n  fromBlock?: iBigInt\n  protocol: Web3Protocol\n  operatorId?: string\n}\n\n/**\n * @deprecated Use generic contract\n */\nexport interface Web3BaseContract {\n  address: string\n  abi?: AbiContract\n  abiCode?: AbiCode\n}\n\n/**\n * @deprecated Use generic contract\n */\nexport function sWeb3BaseContract() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('address', sBCAddress())\n    .required()\n    .prop('abi', sAbiContract())\n    .prop('abiCode', sAbiCode())\n}\n\nexport function sWeb3ProtocolContract() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('protocol', sWeb3Protocol())\n    .prop('fromBlock', sBigInt())\n    .prop('operatorId', sStringId())\n    .extend(sWeb3BaseContract())\n}\n\nexport interface GenericContract {\n  address: string\n  abi?: AbiContract\n  abiCode: AbiCode\n}\n\nexport function sGenericContract() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('address', sBCAddress())\n    .required()\n    .prop('abi', sAbiContract())\n    .prop('abiCode', sAbiCode())\n    .required()\n}\n\nexport type AbiCode =\n  // Generic contract\n  | 'ERC20'\n\n  // CDO\n  | 'CDO_MAIN_V1'\n  | 'CDO_MAIN_V2'\n  | 'CDO_MAIN_V3'\n  | 'CDO_MAIN_V4'\n\n  // CDO Strategy\n  | 'CDO_STRATEGY_MAIN_V1'\n  | 'CDO_STRATEGY_MAIN_V2'\n  | 'CDO_STRATEGY_MAIN_V3'\n\n  // Best Yield\n  | 'BestYield_MAIN_V1'\n  | 'BestYield_MAIN_V2'\n\n  // CDO Epoch\n  | 'CDO_EPOCH_MAIN_V1'\n  | 'CDO_EPOCH_MAIN_V2'\n  | 'CDO_EPOCH_MAIN_V3'\n  | 'CDO_EPOCH_MAIN_V4'\n  | 'CDO_EPOCH_DEPOSIT_QUEUE_V1'\n  | 'CDO_EPOCH_DEPOSIT_QUEUE_V2'\n  | 'CDO_EPOCH_WRITEOFF_V1'\n\n  // CDO Epoch Strategy\n  | 'CDO_EPOCH_STRATEGY_MAIN_V1'\n  | 'CDO_EPOCH_STRATEGY_MAIN_V2'\n\n  // Pareto Dollar\n  | 'PARETO_DOLLAR_MAIN_V1'\n  | 'PARETO_DOLLAR_QUEUE_V1'\n  | 'PARETO_DOLLAR_STAKING_V1'\n\n  // Oracles\n  | 'ORACLE_AaveV2_V1'\n  | 'ORACLE_Balancer_V1'\n  | 'ORACLE_Clearpool_V1'\n  | 'ORACLE_PendleSY_V1'\n  | 'ORACLE_PendlePT_V1'\n  | 'ORACLE_Euler_V1'\n\n  // Pools\n  | 'POOL_AaveV2_V1'\n  | 'POOL_Balancer_V1'\n  | 'POOL_BalancerGauge_V1'\n  | 'POOL_Compound_V1'\n  | 'POOL_Compound_V2'\n  | 'POOL_Ethena_V1'\n  | 'POOL_Gearbox_V1'\n  | 'POOL_Idle_V1'\n  | 'POOL_InstadApp_V1'\n  | 'POOL_Morpho_V1'\n  | 'POOL_NapierLP_V1'\n  | 'POOL_NapierPT_V1'\n  | 'POOL_NapierYT_V1'\n  | 'POOL_PendleLP_V1'\n  | 'POOL_PendlePT_V1'\n  | 'POOL_PendleYT_V1'\n  | 'POOL_Sky_V1'\n  | 'POOL_Euler_V1'\n  | 'POOL_TermFinance_V1'\n\nexport function sAbiCode() {\n  return S.string().enum([\n    'ERC20',\n    'CDO_MAIN_V1',\n    'CDO_MAIN_V2',\n    'CDO_MAIN_V3',\n    'CDO_MAIN_V4',\n    'CDO_STRATEGY_MAIN_V1',\n    'CDO_STRATEGY_MAIN_V2',\n    'CDO_STRATEGY_MAIN_V3',\n    'BestYield_MAIN_V1',\n    'BestYield_MAIN_V2',\n    'CDO_EPOCH_MAIN_V1',\n    'CDO_EPOCH_MAIN_V2',\n    'CDO_EPOCH_MAIN_V3',\n    'CDO_EPOCH_MAIN_V4',\n    'CDO_EPOCH_DEPOSIT_QUEUE_V1',\n    'CDO_EPOCH_DEPOSIT_QUEUE_V2',\n    'CDO_EPOCH_STRATEGY_MAIN_V1',\n    'CDO_EPOCH_STRATEGY_MAIN_V2',\n    'CDO_EPOCH_WRITEOFF_V1',\n    'PARETO_DOLLAR_MAIN_V1',\n    'PARETO_DOLLAR_QUEUE_V1',\n    'PARETO_DOLLAR_STAKING_V1',\n    'ORACLE_AaveV2_V1',\n    'ORACLE_Balancer_V1',\n    'ORACLE_Clearpool_V1',\n    'ORACLE_PendleSY_V1',\n    'ORACLE_PendlePT_V1',\n    'ORACLE_Euler_V1',\n    'POOL_AaveV2_V1',\n    'POOL_Balancer_V1',\n    'POOL_BalancerGauge_V1',\n    'POOL_Compound_V1',\n    'POOL_Compound_V2',\n    'POOL_Ethena_V1',\n    'POOL_Gearbox_V1',\n    'POOL_Idle_V1',\n    'POOL_InstadApp_V1',\n    'POOL_Morpho_V1',\n    'POOL_NapierLP_V1',\n    'POOL_NapierPT_V1',\n    'POOL_NapierYT_V1',\n    'POOL_PendleLP_V1',\n    'POOL_PendlePT_V1',\n    'POOL_PendleYT_V1',\n    'POOL_Sky_V1',\n    'POOL_Euler_V1',\n    'POOL_TermFinance_V1',\n  ])\n}\n"],"names":["sAbiCode","sERC20Token","sGenericContract","sWeb3BaseContract","sWeb3Protocol","sWeb3ProtocolContract","sWeb3ProviderConnection","sWeb3RPCProvider","S","object","additionalProperties","prop","number","required","string","sBCAddress","enum","description","sAbiContract","sBigInt","sStringId","extend"],"mappings":";;;;;;;;;;;IAqbgBA,QAAQ;eAARA;;IArZAC,WAAW;eAAXA;;IAyUAC,gBAAgB;eAAhBA;;IAxBAC,iBAAiB;eAAjBA;;IA3OAC,aAAa;eAAbA;;IAoPAC,qBAAqB;eAArBA;;IAjLAC,uBAAuB;eAAvBA;;IAcAC,gBAAgB;eAAhBA;;;;2EAvLF;sBAG+C;AA6BtD,SAASN;IACd,OAAOO,yBAAC,CAACC,MAAM,GACZC,oBAAoB,CAAC,OACrBC,IAAI,CAAC,YAAYH,yBAAC,CAACI,MAAM,IACzBC,QAAQ,GACRF,IAAI,CAAC,UAAUH,yBAAC,CAACM,MAAM,IACvBD,QAAQ,GACRF,IAAI,CAAC,QAAQH,yBAAC,CAACM,MAAM,IACrBD,QAAQ,GACRF,IAAI,CAAC,WAAWI,IAAAA,gBAAU,KAC1BF,QAAQ;AACb;AA2DO,SAAST;IACd,OAAOI,yBAAC,CAACM,MAAM,GAAGE,IAAI,CAAC;QACrB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH;AAsCO,SAASV;IACd,OAAOE,yBAAC,CAACC,MAAM,GACZC,oBAAoB,CAAC,OACrBC,IAAI,CAAC,YAAYJ,oBACjBU,WAAW,CAAC,qBACZJ,QAAQ,GACRF,IAAI,CAAC,SAASH,yBAAC,CAACM,MAAM,IACtBG,WAAW,CAAC,+BACZN,IAAI,CAAC,OAAOH,yBAAC,CAACM,MAAM,IACpBG,WAAW,CAAC;AACjB;AAIO,SAASV;IACd,OAAOC,yBAAC,CAACM,MAAM,GAAGE,IAAI,CAAC;QAAC;QAAU;QAAW;KAAS;AACxD;AAwJO,SAASb;IACd,OAAOK,yBAAC,CAACC,MAAM,GACZC,oBAAoB,CAAC,OACrBC,IAAI,CAAC,WAAWI,IAAAA,gBAAU,KAC1BF,QAAQ,GACRF,IAAI,CAAC,OAAOO,IAAAA,kBAAY,KACxBP,IAAI,CAAC,WAAWX;AACrB;AAEO,SAASK;IACd,OAAOG,yBAAC,CAACC,MAAM,GACZC,oBAAoB,CAAC,OACrBC,IAAI,CAAC,YAAYP,iBACjBO,IAAI,CAAC,aAAaQ,IAAAA,aAAO,KACzBR,IAAI,CAAC,cAAcS,IAAAA,eAAS,KAC5BC,MAAM,CAAClB;AACZ;AAQO,SAASD;IACd,OAAOM,yBAAC,CAACC,MAAM,GACZC,oBAAoB,CAAC,OACrBC,IAAI,CAAC,WAAWI,IAAAA,gBAAU,KAC1BF,QAAQ,GACRF,IAAI,CAAC,OAAOO,IAAAA,kBAAY,KACxBP,IAAI,CAAC,WAAWX,YAChBa,QAAQ;AACb;AAoEO,SAASb;IACd,OAAOQ,yBAAC,CAACM,MAAM,GAAGE,IAAI,CAAC;QACrB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH"}