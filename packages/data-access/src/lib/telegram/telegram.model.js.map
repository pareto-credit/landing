{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/telegram/telegram.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport { ClientEntity, sClientEntity, sStringId } from '../core'\n\nexport type TgChatType = 'PRIVATE' | 'GROUP'\n\nexport function sTgChatType() {\n  return S.string().enum(['PRIVATE', 'GROUP'])\n}\n\n/**\n * TgSubscription: entity required to manage all the subscriptions\n * to the events notification.\n */\n\nexport interface TgSubscription extends TgSubscriptionData, ClientEntity {}\n\nexport function sTgSubscription(isPartial?: boolean) {\n  return S.object()\n    .id('#tgSubscription')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sTgSubscriptionData(isPartial))\n}\n\nexport interface TgSubscriptionData {\n  // References\n  tgChatId: string\n  tgUserId?: string\n\n  // Chat data\n  type?: TgChatType\n\n  // Only for group chats\n  title?: string\n\n  // User data only for private chats\n  username?: string // Telegram user.username\n  userId?: string // Pareto user._id\n  walletId?: string // Pareto wallet._id\n\n  isVerified?: boolean // If the chat can receive sensitive data\n\n  // Filters\n  filters: TgSubscriptionFilters\n\n  // Subscription options\n  options?: TgSubscriptionOptions\n\n  isActive: boolean\n}\n\nexport function sTgSubscriptionData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('tgChatId', S.string())\n    .prop('tgUserId', S.string())\n    .prop('type', sTgChatType())\n    .prop('title', S.string())\n    .prop('username', S.string())\n    .prop('userId', sStringId())\n    .prop('walletId', sStringId())\n    .prop('isVerified', S.boolean())\n    .prop('filters', sTgSubscriptionFilters())\n    .prop('options', sTgSubscriptionOptions())\n    .prop('isActive', S.boolean())\n    .required(isPartial ? [] : ['tgChatId', 'filters', 'isActive'])\n}\n\nexport interface TgSubscriptionOptions {\n  audience?: 'LENDER' | 'BORROWER' | 'MANAGER'\n  epochAlerts?: TgEpochAlertOptions\n}\n\nexport interface TgEpochAlertOptions {\n  leadMinutes?: number[]\n}\n\nexport function sTgEpochAlertOptions() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('leadMinutes', S.array().items(S.number().minimum(1)))\n}\n\nexport function sTgSubscriptionOptions() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('audience', S.string().enum(['LENDER', 'BORROWER', 'MANAGER']))\n    .prop('epochAlerts', sTgEpochAlertOptions())\n}\n\nexport type TgNotificationEvent = 'EPOCH_END' | 'EPOCH_PRE'\n\nexport function sTgNotificationEvent() {\n  return S.string().enum(['EPOCH_END', 'EPOCH_PRE'])\n}\n\nexport interface TgNotification extends TgNotificationData, ClientEntity {}\n\nexport function sTgNotification(isPartial?: boolean) {\n  return S.object()\n    .id('#tgNotification')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sTgNotificationData(isPartial))\n}\n\nexport interface TgNotificationData {\n  tgSubscriptionId: string\n  vaultId: string\n  vaultEpochId: string\n  event: TgNotificationEvent\n  leadMinutes: number\n}\n\nexport function sTgNotificationData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('tgSubscriptionId', sStringId())\n    .prop('vaultId', sStringId())\n    .prop('vaultEpochId', sStringId())\n    .prop('event', sTgNotificationEvent())\n    .prop('leadMinutes', S.number().minimum(0))\n    .required(\n      isPartial\n        ? []\n        : [\n            'tgSubscriptionId',\n            'vaultId',\n            'vaultEpochId',\n            'event',\n            'leadMinutes',\n          ]\n    )\n}\n\nexport interface TgSubscriptionFilters {\n  vaultId?: string[]\n  walletId?: string[]\n}\n\nexport function sTgSubscriptionFilters() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('vaultId', S.array().items(sStringId()))\n    .prop('walletId', S.array().items(sStringId()))\n}\n"],"names":["sTgChatType","sTgEpochAlertOptions","sTgNotification","sTgNotificationData","sTgNotificationEvent","sTgSubscription","sTgSubscriptionData","sTgSubscriptionFilters","sTgSubscriptionOptions","S","string","enum","isPartial","object","id","additionalProperties","extend","sClientEntity","prop","sStringId","boolean","required","array","items","number","minimum"],"mappings":"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"}