{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/wallet-performances/wallet-performance.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport {\n  sBCAddress,\n  sBigInt,\n  sBlock,\n  sClientEntity,\n  sPageSearchQuery,\n  sPercentage,\n  sReward,\n  sStringId,\n} from '../core'\nimport { Block, ClientEntity, PageSearchQuery, Reward, iBigInt } from '../core'\nimport { WALLET_PERFORMANCES_ROUTES_KEY } from './wallet-performance.const'\nimport {\n  sWalletBlockDistributedRewards,\n  WalletBlockDistributedRewards,\n} from '../wallet-blocks'\n\n/**\n * Client WalletPerformance interface\n */\nexport interface WalletPerformance\n  extends WalletPerformanceData,\n    ClientEntity {}\n\nexport function sWalletPerformance(isPartial?: boolean) {\n  return S.object()\n    .id('#walletPerformance')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sWalletPerformanceData(isPartial))\n}\n\nexport interface WalletPerformanceData extends WalletBlockPerformance {\n  walletId: string\n  walletBlockId: string\n  vaultId: string\n  block: Block\n}\n\nexport function sWalletPerformanceData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletId', sStringId())\n    .prop('walletBlockId', sStringId())\n    .prop('vaultId', sStringId())\n    .prop('block', sBlock())\n    .required(\n      isPartial ? [] : ['walletId', 'walletBlockId', 'vaultId', 'block']\n    )\n    .extend(sWalletBlockPerformance(isPartial))\n}\n\nexport interface WalletPortfolio extends WalletBlockPerformance {\n  vaultIds: string[]\n  operators: WalletPositionOperator[]\n  chains: WalletPositionChain[]\n  tokens: WalletPositionToken[]\n  deposits: WalletBlockAmounts\n  redeemable: WalletBlockAmounts\n}\n\nexport function sWalletPositionAggregated() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('vaultIds', S.array().items(sStringId()))\n    .required()\n    .prop('operators', S.array().items(sWalletPositionOperator()))\n    .required()\n    .prop('chains', S.array().items(sWalletPositionChain()))\n    .required()\n    .prop('tokens', S.array().items(sWalletPositionToken()))\n    .required()\n    .prop('deposits', sWalletBlockAmounts())\n    .description(\"The user's deposits.\")\n    .required()\n    .prop('redeemable', sWalletBlockAmounts())\n    .description(\"The user's redeemable amounts.\")\n    .required()\n    .extend(sWalletBlockPerformance())\n}\n\nexport interface WalletPositionToken {\n  tokenId: string\n  tokenAddress: string\n  amount: iBigInt\n  USD: iBigInt\n  percentage: number\n}\n\nexport function sWalletPositionToken() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('tokenId', sStringId())\n    .required()\n    .prop('tokenAddress', sBCAddress())\n    .required()\n    .prop('amount', sBigInt())\n    .required()\n    .prop('USD', sBigInt())\n    .required()\n    .prop('percentage', S.number())\n    .required()\n}\n\nexport interface WalletPositionChain {\n  chainId: string\n  USD: iBigInt\n  percentage: number\n}\n\nexport function sWalletPositionChain() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('chainId', sStringId())\n    .required()\n    .prop('USD', sBigInt())\n    .required()\n    .prop('percentage', S.number())\n    .required()\n}\n\nexport interface WalletPositionOperator {\n  operatorId: string\n  USD: iBigInt\n  percentage: number\n}\n\nexport function sWalletPositionOperator() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('operatorId', sStringId())\n    .required()\n    .prop('USD', sBigInt())\n    .required()\n    .prop('percentage', S.number())\n    .required()\n}\n\nexport interface WalletDistributedRewards\n  extends WalletBlockDistributedRewards {\n  block: Block\n  APR: number\n  percentage: number\n}\n\nexport function sWalletDistributedRewards() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('block', sBlock())\n    .required()\n    .prop('APR', S.number())\n    .required()\n    .prop('percentage', S.number())\n    .required()\n    .extend(sWalletBlockDistributedRewards())\n}\n\nexport interface WalletDeposits {\n  avgPrice: iBigInt\n  firstBlock?: Block\n  deposits: WalletBlockAmounts\n  redeemable: WalletBlockAmounts\n}\n\nexport interface WalletVaultBalance {\n  block: Block\n  balance: iBigInt\n  tokenBalance: iBigInt\n}\n\nexport function sWalletVaultBalance() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('block', sBlock())\n    .required()\n    .prop('balance', sBigInt())\n    .description('The balance of the wallet in the vault.')\n    .required()\n    .prop('tokenBalance', sBigInt())\n    .description('The current token balance of the wallet.')\n    .required()\n}\n\nexport interface WalletPosition extends WalletBlockPerformance, WalletDeposits {\n  tokenId: string\n  vaultId: string\n  chainId: string\n  vaultPrice: string\n  vaultAddress: string\n  tokenAddress: string\n  balances?: WalletVaultBalance[]\n}\n\nexport function sWalletPosition() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('vaultId', sStringId())\n    .required()\n    .prop('chainId', sStringId())\n    .required()\n    .prop('tokenId', sStringId())\n    .required()\n    .prop('vaultAddress', sBCAddress())\n    .required()\n    .prop('tokenAddress', sBCAddress())\n    .required()\n    .prop('vaultPrice', sBigInt())\n    .description('The current vault price')\n    .required()\n    .prop('avgPrice', sBigInt())\n    .description(\"The user's avg buy price.\")\n    .required()\n    .prop('deposits', sWalletBlockAmounts())\n    .description(\"The user's deposits.\")\n    .required()\n    .prop('redeemable', sWalletBlockAmounts())\n    .description(\"The user's redeemable amounts.\")\n    .required()\n    .prop('balances', S.array().items(sWalletVaultBalance()))\n    .description(\"The user's redeemable amounts.\")\n    .extend(sWalletBlockPerformance())\n}\n\nexport interface WalletBlockPerformance {\n  // The age of the wallet block performance in seconds\n  age: number\n  // Earnings\n  earnings: WalletBlockEarnings\n  // APY realized\n  realizedAPY: number\n  // Percentage of the pool\n  poolSharePercentage: number\n  // Rewards accrued but not yet received\n  accruedRewards?: Reward[]\n  // Rewards actually received\n  collectedRewards?: Reward[]\n}\n\nexport function sWalletBlockPerformance(isPartial?: boolean) {\n  return (\n    S.object()\n      .additionalProperties(false)\n      .prop('age', S.number())\n      .prop('earnings', sWalletBlockEarnings())\n      .description(\"The user's earnings.\")\n      .prop('realizedAPY', S.number())\n      .description(\"The user's APY realized.\")\n      .prop('poolSharePercentage', sPercentage())\n      .description('The pool share percentage of the user.')\n      .prop('accruedRewards', S.array().items(sReward()))\n      .description('The accrued rewards of the user.')\n      .prop('collectedRewards', S.array().items(sReward()))\n      .description('The collected rewards of the user.')\n\n      // Backward-compatible\n      .prop('balance', sBigInt())\n      .description('The balance of the wallet in the vault.')\n      .prop('tokenBalance', sBigInt())\n      .description('The current token balance of the wallet.')\n      .required(\n        isPartial\n          ? []\n          : ['age', 'earnings', 'realizedAPY', 'poolSharePercentage']\n      )\n  )\n}\n\nexport interface WalletBlockAmounts {\n  // USD amount\n  USD: iBigInt\n  // Underlying token amount\n  token?: iBigInt\n  // Idle token amount\n  vault?: iBigInt\n}\n\nexport function sWalletBlockAmounts() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('USD', sBigInt())\n    .description(\"The wallet's earnings in USD.\")\n    .required()\n    .prop('token', sBigInt())\n    .description(\"The wallet's earnings in underlying tokens.\")\n    .prop('vault', sBigInt())\n    .description(\"The wallet's earnings in vault tokens.\")\n}\n\nexport interface WalletBlockEarnings extends WalletBlockAmounts {\n  // The percentage of the earning from the starting price\n  percentage: number\n  // Rewards\n  rewards?: WalletBlockEarningsRewards\n}\n\nexport function sWalletBlockEarnings() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('percentage', S.number())\n    .description(\"The wallet's percentage earnings.\")\n    .required()\n    .prop('rewards', sWalletBlockEarningsRewards())\n    .description(\"The user's rewards earnings.\")\n    .extend(sWalletBlockAmounts())\n}\n\nexport interface WalletBlockEarningsRewards {\n  // USD amount\n  USD: iBigInt\n  // The percentage of the earning from the starting price\n  percentage: number\n}\n\nexport function sWalletBlockEarningsRewards() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('USD', sBigInt())\n    .description(\"The wallet's rewards USD earnings.\")\n    .required()\n    .prop('percentage', S.number())\n    .description(\"The wallet's rewards percentage earnings.\")\n    .required()\n}\n\nexport enum WalletPerformanceErrorCodes {\n  alreadyExists = 'WALLET_PERFORMANCE_ALREADY_EXISTS',\n  rewardProgramNotFound = 'WALLET_PERFORMANCE_REWARD_PROGRAM_NOT_FOUND',\n}\n\nexport type WalletPerformanceFields =\n  | '_id'\n  | 'walletId'\n  | 'walletBlockId'\n  | 'vaultId'\n  | 'block'\n  | 'age'\n  | 'earnings'\n  | 'realizedAPY'\n  | 'poolSharePercentage'\n  | 'accruedRewards'\n  | 'collectedRewards'\n  | 'createdAt'\n  | 'createdBy'\n  | 'updatedAt'\n  | 'updatedBy'\n\nexport const WALLET_PERFORMANCE_FIELDS = [\n  '_id',\n  'walletId',\n  'walletBlockId',\n  'vaultId',\n  'block',\n  'age',\n  'earnings',\n  'realizedAPY',\n  'poolSharePercentage',\n  'accruedRewards',\n  'collectedRewards',\n  'createdAt',\n  'createdBy',\n  'updatedAt',\n  'updatedBy',\n]\n\nexport const WALLET_PERFORMANCE_SORT_FIELDS = ['block', 'timestamp']\n\nexport interface WalletPerformancesSearchQuery\n  extends PageSearchQuery<'block' | 'timestamp', WalletPerformanceFields> {\n  vaultId?: string | string[]\n  walletId?: string | string[]\n  walletBlockId?: string | string[]\n  'timestamp:gte'?: number\n  'timestamp:lte'?: number\n}\n\nexport function sWalletPerformancesSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletId', S.array().minItems(1).maxItems(200).items(sStringId()))\n    .description('Wallet IDs of the performance that must match.')\n    .prop('vaultId', S.array().minItems(1).maxItems(200).items(sStringId()))\n    .description('Vault IDs of the performance that must match.')\n    .prop(\n      'walletBlockId',\n      S.array().minItems(1).maxItems(200).items(sStringId())\n    )\n    .description('Wallet block IDs of the performance that must match.')\n    .prop('timestamp:gte', S.number())\n    .description('Start timestamp of the performance.')\n    .prop('timestamp:lte', S.number())\n    .description('End timestamp of the performance.')\n    .extend(\n      sPageSearchQuery(\n        WALLET_PERFORMANCE_FIELDS,\n        WALLET_PERFORMANCE_SORT_FIELDS\n      )\n    )\n}\n\nexport enum WalletPerformanceRoutes {\n  v1Create = `v1/${WALLET_PERFORMANCES_ROUTES_KEY}`,\n  v1Delete = `v1/${WALLET_PERFORMANCES_ROUTES_KEY}/:walletPerformanceId`,\n  v1Read = `v1/${WALLET_PERFORMANCES_ROUTES_KEY}/:walletPerformanceId`,\n  v1Update = `v1/${WALLET_PERFORMANCES_ROUTES_KEY}/:walletPerformanceId`,\n  v1Search = `v1/${WALLET_PERFORMANCES_ROUTES_KEY}`,\n}\n"],"names":["S","sBCAddress","sBigInt","sBlock","sClientEntity","sPageSearchQuery","sPercentage","sReward","sStringId","WALLET_PERFORMANCES_ROUTES_KEY","sWalletBlockDistributedRewards","sWalletPerformance","isPartial","object","id","additionalProperties","extend","sWalletPerformanceData","prop","required","sWalletBlockPerformance","sWalletPositionAggregated","array","items","sWalletPositionOperator","sWalletPositionChain","sWalletPositionToken","sWalletBlockAmounts","description","number","sWalletDistributedRewards","sWalletVaultBalance","sWalletPosition","sWalletBlockEarnings","sWalletBlockEarningsRewards","WalletPerformanceErrorCodes","WALLET_PERFORMANCE_FIELDS","WALLET_PERFORMANCE_SORT_FIELDS","sWalletPerformancesSearchQuery","minItems","maxItems","WalletPerformanceRoutes"],"mappings":"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"}