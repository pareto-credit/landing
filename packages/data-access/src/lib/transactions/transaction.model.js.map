{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/transactions/transaction.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport {\n  Block,\n  ClientEntity,\n  Page,\n  PageSearchQuery,\n  iBigInt,\n  sBCAddress,\n  sBCHash,\n  sBigInt,\n  sBlock,\n  sClientEntity,\n  sDateString,\n  sPageSearchQuery,\n  sStringId,\n} from '../core'\nimport { TRANSACTIONS_ROUTES_KEY } from './transaction.const'\nimport { uniq } from 'lodash'\n\n/**\n * Client Transaction interface\n */\nexport interface Transaction extends TransactionData, ClientEntity {}\n\nexport function sTransaction(isPartial?: boolean) {\n  return S.object()\n    .id('#transaction')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sTransactionData(isPartial))\n}\n\nexport interface TransactionData {\n  vaultId: string\n  vaultAddress: string\n  walletId: string\n  walletAddress: string\n  fromAddress?: string\n  toAddress?: string\n  tokenId: string\n  operatorId?: string\n  type: TransactionType\n  hash: string\n  block: Block\n  amount: iBigInt\n  tokenAmount: iBigInt\n  price: iBigInt\n  input?: string\n  transactionDate?: string\n}\n\nexport function sTransactionData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('vaultId', sStringId())\n    .description('The vault IDentifier.')\n    .prop('vaultAddress', sBCAddress())\n    .description('The vault blockchain address.')\n    .prop('walletId', sStringId())\n    .description('The IDentifier of the wallet.')\n    .prop('walletAddress', sBCAddress())\n    .description('The wallet blockchain address.')\n    .prop('fromAddress', sBCAddress())\n    .description('The from blockchain address.')\n    .prop('toAddress', sBCAddress())\n    .description('The to blockchain address.')\n    .prop('tokenId', sStringId())\n    .description('The token IDentifier.')\n    .prop('operatorId', sStringId())\n    .description('The operator IDentifier.')\n    .prop('type', sTransactionType())\n    .description('The transaction type.')\n    .prop('hash', sBCHash())\n    .description('The transaction hash.')\n    .prop('block', sBlock())\n    .description('The transaction blockchain block.')\n    .prop('amount', sBigInt())\n    .description('The transaction amount.')\n    .prop('tokenAmount', sBigInt())\n    .description('The transaction token amount.')\n    .prop('price', sBigInt())\n    .description('The transaction vault price.')\n    .prop('input', S.string())\n    .description('The transaction input data.')\n    .prop('transactionDate', sDateString())\n    .description('The transaction date.')\n    .required(\n      isPartial\n        ? []\n        : [\n            'vaultId',\n            'vaultAddress',\n            'walletId',\n            'walletAddress',\n            'tokenId',\n            'type',\n            'hash',\n            'block',\n            'amount',\n            'tokenAmount',\n            'price',\n          ]\n    )\n}\n\n/**\n * #################################\n * ####### TRANSACTION TYPES #######\n * #################################\n */\n\nexport type TransactionTypeCommon =\n  | 'DEPOSIT'\n  | 'REDEEM'\n  | 'HARVEST'\n  | 'DISTRIBUTED_REWARDS'\n\nexport const TRANSACTION_TYPES_COMMON = [\n  'DEPOSIT',\n  'REDEEM',\n  'HARVEST',\n  'DISTRIBUTED_REWARDS',\n]\n\n/**\n * Vault Pareto Dollar\n */\n\nexport type TransactionTypeParetoDollar =\n  | 'ADD_COLLATERAL'\n  | 'ADD_YIELD_SOURCE'\n  | 'CLAIM_REDEEM_REQUEST'\n  | 'DEPOSIT_REWARDS'\n  | 'DEPOSIT_YIELD_SOURCE'\n  | 'MINT'\n  | 'NEW_EPOCH'\n  | 'REDEEM'\n  | 'REDEEM_YIELD_SOURCE'\n  | 'REMOVE_COLLATERAL'\n  | 'REMOVE_YIELD_SOURCE'\n  | 'REQUEST_REDEEM'\n  | 'STAKE'\n  | 'STAKE_POOL'\n  | 'TRANSFER'\n  | 'TRANSFER_POOL'\n  | 'UNSTAKE'\n  | 'UNSTAKE_POOL'\n\nexport const TRANSACTION_TYPES_PARETO_DOLLAR = [\n  'ADD_COLLATERAL',\n  'ADD_YIELD_SOURCE',\n  'CLAIM_REDEEM_REQUEST',\n  'DEPOSIT_REWARDS',\n  'DEPOSIT_YIELD_SOURCE',\n  'MINT',\n  'NEW_EPOCH',\n  'REDEEM',\n  'REDEEM_YIELD_SOURCE',\n  'REMOVE_COLLATERAL',\n  'REMOVE_YIELD_SOURCE',\n  'REQUEST_REDEEM',\n  'STAKE',\n  'STAKE_POOL',\n  'TRANSFER',\n  'TRANSFER_POOL',\n  'UNSTAKE',\n  'UNSTAKE_POOL',\n]\n\nexport function sTransactionTypeParetoDollar() {\n  return S.string().enum(TRANSACTION_TYPES_PARETO_DOLLAR)\n}\n\n/**\n * Vault CDO Epoch\n */\n\nexport const TRANSACTION_TYPES_CDO_EPOCH = [\n  'CLAIM_DEPOSIT_REQUEST',\n  'CLAIM_INSTANT_WITHDRAW',\n  'CLAIM_WITHDRAW',\n  'CLAIM_WITHDRAW_REQUEST',\n  'DELETE_DEPOSIT_REQUEST',\n  'DELETE_WITHDRAW_REQUEST',\n  'GET_INSTANT_WITHDRAWS',\n  'PROCESS_DEPOSIT_QUEUE',\n  'PROCESS_WITHDRAW_CLAIMS',\n  'PROCESS_WITHDRAW_QUEUE',\n  'REQUEST_DEPOSIT',\n  'REQUEST_WITHDRAW',\n  'START_EPOCH',\n  'STOP_EPOCH',\n  'REQUEST_WRITEOFF',\n  'DELETE_WRITEOFF_REQUEST',\n  'FULFILL_WRITEOFF_REQUEST',\n  'DEPOSIT_WRITEOFF_REQUEST',\n]\n\nexport type TransactionTypeCdoEpoch =\n  | 'CLAIM_DEPOSIT_REQUEST'\n  | 'CLAIM_INSTANT_WITHDRAW'\n  | 'CLAIM_WITHDRAW'\n  | 'CLAIM_WITHDRAW_REQUEST'\n  | 'DELETE_DEPOSIT_REQUEST'\n  | 'DELETE_WITHDRAW_REQUEST'\n  | 'GET_INSTANT_WITHDRAWS'\n  | 'PROCESS_DEPOSIT_QUEUE'\n  | 'PROCESS_WITHDRAW_CLAIMS'\n  | 'PROCESS_WITHDRAW_QUEUE'\n  | 'REQUEST_DEPOSIT'\n  | 'REQUEST_WITHDRAW'\n  | 'START_EPOCH'\n  | 'STOP_EPOCH'\n  | 'REQUEST_WRITEOFF'\n  | 'DELETE_WRITEOFF_REQUEST'\n  | 'FULFILL_WRITEOFF_REQUEST'\n  | 'DEPOSIT_WRITEOFF_REQUEST'\n\nexport function sTransactionTypeCdoEpoch() {\n  return S.string().enum(TRANSACTION_TYPES_CDO_EPOCH)\n}\n\nexport type TransactionType =\n  | TransactionTypeCommon\n  | TransactionTypeParetoDollar\n  | TransactionTypeCdoEpoch\n\nexport const TRANSACTION_TYPES = [\n  ...TRANSACTION_TYPES_COMMON,\n  ...TRANSACTION_TYPES_PARETO_DOLLAR,\n  ...TRANSACTION_TYPES_CDO_EPOCH,\n]\n\nexport function sTransactionType() {\n  return S.string().enum(uniq(TRANSACTION_TYPES))\n}\n\n/**\n * #####################################\n * ####### END TRANSACTION TYPES #######\n * #####################################\n */\n\nexport type TransactionFields =\n  | '_id'\n  | 'vaultId'\n  | 'vaultAddress'\n  | 'walletId'\n  | 'walletAddress'\n  | 'tokenId'\n  | 'type'\n  | 'hash'\n  | 'block'\n  | 'amount'\n  | 'tokenAmount'\n  | 'price'\n  | 'input'\n  | 'createdAt'\n  | 'createdBy'\n  | 'updatedAt'\n  | 'updatedBy'\n\nexport const TRANSACTION_FIELDS = [\n  '_id',\n  'vaultId',\n  'vaultAddress',\n  'walletId',\n  'walletAddress',\n  'tokenId',\n  'type',\n  'hash',\n  'block',\n  'amount',\n  'tokenAmount',\n  'price',\n  'input',\n  'createdAt',\n  'createdBy',\n  'updatedAt',\n  'updatedBy',\n]\n\nexport const TRANSACTION_SORT_FIELDS = ['_id', 'block', 'timestamp']\n\nexport type TransactionsSideData =\n  | 'wallet'\n  | 'user'\n  | 'token'\n  | 'vault'\n  | 'operator'\n\nexport interface TransactionsSearchQuery\n  extends PageSearchQuery<'block' | 'timestamp', TransactionFields> {\n  vaultId?: string | string[]\n  vaultAddress?: string | string[]\n  walletId?: string | string[]\n  walletAddress?: string | string[]\n  block?: string\n  tokenId?: string\n  type?: TransactionType | TransactionType[]\n  'timestamp:gte'?: number\n  'timestamp:lte'?: number\n}\n\n// Route schema\nexport function sTransactionsSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('vaultId', S.array().minItems(1).maxItems(200).items(sStringId()))\n    .description('The vault IDentifier of the transaction.')\n    .prop(\n      'vaultAddress',\n      S.array().minItems(1).maxItems(200).items(sBCAddress())\n    )\n    .description('The vualt address of the transaction.')\n    .prop('walletId', S.array().minItems(1).maxItems(200).items(sStringId()))\n    .description('The wallet IDentifier of the transaction.')\n    .prop(\n      'walletAddress',\n      S.array().minItems(1).maxItems(200).items(sBCAddress())\n    )\n    .description('The wallet address of the transaction.')\n    .prop('tokentId', sStringId())\n    .description('The token IDentifier of the transaction.')\n    .prop('type', S.array().minItems(1).maxItems(200).items(sTransactionType()))\n    .description('The type of the transaction.')\n    .prop('block', S.string())\n    .description('The block of the transaction.')\n    .prop('timestamp:gte', S.number())\n    .description('Start timestamp of the transaction.')\n    .prop('timestamp:lte', S.number())\n    .description('End timestamp of the transaction.')\n    .extend(sPageSearchQuery(TRANSACTION_FIELDS, TRANSACTION_SORT_FIELDS))\n}\n\nexport enum TransactionRoutes {\n  v1Create = `v1/${TRANSACTIONS_ROUTES_KEY}`,\n  v1Delete = `v1/${TRANSACTIONS_ROUTES_KEY}/:tokenId`,\n  v1Read = `v1/${TRANSACTIONS_ROUTES_KEY}/:tokenId`,\n  v1Update = `v1/${TRANSACTIONS_ROUTES_KEY}/:tokenId`,\n  v1Search = `v1/${TRANSACTIONS_ROUTES_KEY}`,\n}\n\nexport interface TransactionsClientModel {\n  search: (params?: TransactionsSearchQuery) => Promise<Page<Transaction>>\n  list: (params?: TransactionsSearchQuery) => Promise<Transaction[]>\n  findOne: (\n    params?: TransactionsSearchQuery\n  ) => Promise<Transaction | undefined>\n  create: (body: TransactionData) => Promise<Transaction>\n}\n"],"names":["TRANSACTION_FIELDS","TRANSACTION_SORT_FIELDS","TRANSACTION_TYPES","TRANSACTION_TYPES_CDO_EPOCH","TRANSACTION_TYPES_COMMON","TRANSACTION_TYPES_PARETO_DOLLAR","sTransaction","sTransactionData","sTransactionType","sTransactionTypeCdoEpoch","sTransactionTypeParetoDollar","sTransactionsSearchQuery","isPartial","S","object","id","additionalProperties","extend","sClientEntity","prop","sStringId","description","sBCAddress","sBCHash","sBlock","sBigInt","string","sDateString","required","enum","uniq","array","minItems","maxItems","items","number","sPageSearchQuery","TransactionRoutes","TRANSACTIONS_ROUTES_KEY"],"mappings":"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"}