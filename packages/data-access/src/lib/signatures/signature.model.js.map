{"version":3,"sources":["../../../../../../../libs/shared/data-access/src/lib/signatures/signature.model.ts"],"sourcesContent":["import S from 'fluent-json-schema'\nimport {\n  ClientEntity,\n  Locales,\n  Page,\n  PageSearchQuery,\n  sBCAddress,\n  sClientEntity,\n  sHexString,\n  sLocales,\n  sPageSearchQuery,\n} from '../core'\nimport { SIGNATURES_ROUTES_KEY } from './signature.const'\nimport { WalletSignature } from '../wallets'\n\n/**\n * Client Signature interface\n */\nexport interface Signature extends SignatureData, ClientEntity {}\n\nexport function sSignature(isPartial?: boolean) {\n  return S.object()\n    .id('#signature')\n    .additionalProperties(false)\n    .extend(sClientEntity(isPartial))\n    .extend(sSignatureData(isPartial))\n}\n\nexport interface SignatureData {\n  // Reference code\n  code: string\n\n  // UI data\n  title?: Locales\n  description?: Locales\n\n  // Wallet encoded message\n  walletMessage: string\n\n  // User checks\n  checks?: SignatureCheck[]\n}\n\nexport function sSignatureData(isPartial?: boolean) {\n  return S.object()\n    .additionalProperties(false)\n    .prop('code', S.string())\n    .prop('title', sLocales())\n    .prop('description', sLocales())\n    .prop('walletMessage', S.string())\n    .prop('checks', S.array().items(sSignatureCheck()))\n    .required(isPartial ? [] : ['code', 'walletMessage'])\n}\n\nexport interface SignatureCheck {\n  label: Locales\n  link?: string\n}\n\nexport function sSignatureCheck() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('label', sLocales())\n    .required()\n    .prop('link', S.string())\n}\n\nexport type SignatureFields =\n  | '_id'\n  | 'name'\n  | 'message'\n  | 'checks'\n  | 'createdAt'\n  | 'createdBy'\n  | 'updatedAt'\n  | 'updatedBy'\n\nexport const SIGNATURE_FIELDS = [\n  '_id',\n  'name',\n  'message',\n  'checks',\n  'createdAt',\n  'createdBy',\n  'updatedAt',\n  'updatedBy',\n]\n\nexport interface SignaturesSearchQuery extends PageSearchQuery {\n  name?: string\n}\n\nexport function sSignaturesSearchQuery() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('name')\n    .description('Name that must match')\n    .extend(sPageSearchQuery(SIGNATURE_FIELDS))\n}\n\nexport interface SignatureCheckBody {\n  walletAddress: string\n}\n\nexport function sSignatureCheckBody() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletAddress', sBCAddress())\n    .required()\n}\n\nexport interface SignatureSignBody {\n  walletAddress: string\n  hash: string\n}\n\nexport function sSignatureSignBody() {\n  return S.object()\n    .additionalProperties(false)\n    .prop('walletAddress', sBCAddress())\n    .required()\n    .prop('hash', sHexString())\n    .description('Signature hash')\n    .required()\n}\n\nexport enum SignatureErrorCodes {\n  alreadyExists = 'SIGNATURE_ALREADY_EXISTS',\n  notDeletable = 'SIGNATURE_NOT_DELETABLE',\n  notExists = 'SIGNATURE_NOT_EXISTS',\n  verificationFailed = 'SIGNATURE_VERIFICATION_FAILED',\n}\n\nexport enum SignatureRoutes {\n  v1Create = `v1/${SIGNATURES_ROUTES_KEY}`,\n  v1Check = `v1/${SIGNATURES_ROUTES_KEY}/:signatureId/check`,\n  v1Sign = `v1/${SIGNATURES_ROUTES_KEY}/:signatureId/sign`,\n  v1Delete = `v1/${SIGNATURES_ROUTES_KEY}/:signatureId`,\n  v1Read = `v1/${SIGNATURES_ROUTES_KEY}/:signatureId`,\n  v1Update = `v1/${SIGNATURES_ROUTES_KEY}/:signatureId`,\n  v1Search = `v1/${SIGNATURES_ROUTES_KEY}`,\n}\n\nexport interface SignaturesClientModel {\n  create: (body: SignatureData) => Promise<Signature>\n  search: (params?: SignaturesSearchQuery) => Promise<Page<Signature>>\n  searchAll: (params?: SignaturesSearchQuery) => Promise<Page<Signature>>\n  list: (params?: SignaturesSearchQuery) => Promise<Signature[]>\n  listAll: (params?: SignaturesSearchQuery) => Promise<Signature[]>\n  findOne: (params?: SignaturesSearchQuery) => Promise<Signature | undefined>\n  readOne: (params: SignaturesSearchQuery) => Promise<Signature>\n  check: (\n    signatureId: string,\n    params: SignatureCheckBody\n  ) => Promise<WalletSignature>\n  sign: (\n    signatureId: string,\n    params: SignatureSignBody\n  ) => Promise<WalletSignature>\n}\n"],"names":["SIGNATURE_FIELDS","sSignature","sSignatureCheck","sSignatureCheckBody","sSignatureData","sSignatureSignBody","sSignaturesSearchQuery","isPartial","S","object","id","additionalProperties","extend","sClientEntity","prop","string","sLocales","array","items","required","description","sPageSearchQuery","sBCAddress","sHexString","SignatureErrorCodes","SignatureRoutes","SIGNATURES_ROUTES_KEY"],"mappings":";;;;;;;;;;;IA6EaA,gBAAgB;eAAhBA;;;;;;;;IAzDGC,UAAU;eAAVA;;IAuCAC,eAAe;eAAfA;;IA6CAC,mBAAmB;eAAnBA;;IA7DAC,cAAc;eAAdA;;IAyEAC,kBAAkB;eAAlBA;;IAxBAC,sBAAsB;eAAtBA;;;;2EA5FF;sBAWP;gCAC+B;AAQ/B,SAASL,WAAWM,SAAmB;IAC5C,OAAOC,yBAAC,CAACC,MAAM,GACZC,EAAE,CAAC,cACHC,oBAAoB,CAAC,OACrBC,MAAM,CAACC,IAAAA,mBAAa,EAACN,YACrBK,MAAM,CAACR,eAAeG;AAC3B;AAiBO,SAASH,eAAeG,SAAmB;IAChD,OAAOC,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QAAQN,yBAAC,CAACO,MAAM,IACrBD,IAAI,CAAC,SAASE,IAAAA,cAAQ,KACtBF,IAAI,CAAC,eAAeE,IAAAA,cAAQ,KAC5BF,IAAI,CAAC,iBAAiBN,yBAAC,CAACO,MAAM,IAC9BD,IAAI,CAAC,UAAUN,yBAAC,CAACS,KAAK,GAAGC,KAAK,CAAChB,oBAC/BiB,QAAQ,CAACZ,YAAY,EAAE,GAAG;QAAC;QAAQ;KAAgB;AACxD;AAOO,SAASL;IACd,OAAOM,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,SAASE,IAAAA,cAAQ,KACtBG,QAAQ,GACRL,IAAI,CAAC,QAAQN,yBAAC,CAACO,MAAM;AAC1B;AAYO,MAAMf,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAMM,SAASM;IACd,OAAOE,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,QACLM,WAAW,CAAC,wBACZR,MAAM,CAACS,IAAAA,sBAAgB,EAACrB;AAC7B;AAMO,SAASG;IACd,OAAOK,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,iBAAiBQ,IAAAA,gBAAU,KAChCH,QAAQ;AACb;AAOO,SAASd;IACd,OAAOG,yBAAC,CAACC,MAAM,GACZE,oBAAoB,CAAC,OACrBG,IAAI,CAAC,iBAAiBQ,IAAAA,gBAAU,KAChCH,QAAQ,GACRL,IAAI,CAAC,QAAQS,IAAAA,gBAAU,KACvBH,WAAW,CAAC,kBACZD,QAAQ;AACb;;UAEYK;;;;;GAAAA,wBAAAA;;UAOAC;kDACC,CAAC,GAAG,EAAEC,qCAAqB,CAAC,CAAC;iDAC9B,CAAC,GAAG,EAAEA,qCAAqB,CAAC,mBAAmB,CAAC;gDACjD,CAAC,GAAG,EAAEA,qCAAqB,CAAC,kBAAkB,CAAC;kDAC7C,CAAC,GAAG,EAAEA,qCAAqB,CAAC,aAAa,CAAC;gDAC5C,CAAC,GAAG,EAAEA,qCAAqB,CAAC,aAAa,CAAC;kDACxC,CAAC,GAAG,EAAEA,qCAAqB,CAAC,aAAa,CAAC;kDAC1C,CAAC,GAAG,EAAEA,qCAAqB,CAAC,CAAC;GAP9BD,oBAAAA"}